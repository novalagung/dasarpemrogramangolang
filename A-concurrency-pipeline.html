<!DOCTYPE HTML>
<html lang>
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Golang Concurrency Pattern: Pipeline - Dasar Pemrograman Golang</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content>
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-docsearch-v3/style.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-disqus/plugin.css" media="print" onload="this.media='all'">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css" media="print" onload="this.media='all'">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css" media="print" onload="this.media='all'">
                
            
        

    

    
        
        <link rel="stylesheet" href="style-website-v4.css">
        
    

        
    
    
    <meta name="google-site-verification" content="UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE">
    
    <meta name="og:image" content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg">
    
    <meta name="twitter:image" content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg">
    
    
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="A-simplified-fan-in-fan-out-pipeline.html">
    
    
    <link rel="prev" href="A-go-vendoring.html">
    


    <script async defer src="https://buttons.github.io/buttons.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-MZ74P74K72"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'G-MZ74P74K72');
		</script></head>
    <body>
        
<div class="book">
    <div class="book-summary"><div id="book-search-input"><div id="book-doc-search-input"></div></div>
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Dasar Pemrograman Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="CHANGELOG.html">
            
                <a href="CHANGELOG.html">
            
                    
                    Version Changelogs &amp; Updates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="download-ebook.html">
            
                <a href="download-ebook.html">
            
                    
                    Download Ebook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="CONTRIBUTING.html">
            
                <a href="CONTRIBUTING.html">
            
                    
                    Author &amp; Contributors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="DISTRIBUTION.html">
            
                <a href="DISTRIBUTION.html">
            
                    
                    Lisensi dan Distribusi Konten
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1">
            
                <span>
            
                    
                    Referensi Belajar Lainnya
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1">
            
                <a target="_blank" href="https://dasarpemrogramanpython.novalagung.com/">
            
                    
                    &#x1F4D6; Dasar Pemrograman Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2">
            
                <a target="_blank" href="https://dasarpemrogramanrust.novalagung.com/">
            
                    
                    &#x1F4D6; Dasar Pemrograman Rust
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3">
            
                <a target="_blank" href="https://howto.novalagung.com">
            
                    
                    &#x1F4D6; How To
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4">
            
                <a target="_blank" href="https://www.udemy.com/course/praktis-belajar-docker-dan-kubernetes-untuk-pemula/">
            
                    
                    &#x25B6;&#xFE0F; Udemy Course: Belajar Docker &amp; Kubernetes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1">
            
                <span>
            
                    
                    A. Pemrograman Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="1-berkenalan-dengan-golang.html">
            
                <a href="1-berkenalan-dengan-golang.html">
            
                    
                    A.1. Belajar Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="2-instalasi-golang.html">
            
                <a href="2-instalasi-golang.html">
            
                    
                    A.2. Instalasi Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="A-setup-go-project-dengan-go-modules.html">
            
                <a href="A-setup-go-project-dengan-go-modules.html">
            
                    
                    A.3. Setup Go Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="A-gopath-dan-workspace.html">
            
                <a href="A-gopath-dan-workspace.html">
            
                    
                    A.4. Setup GOPATH dan Workspace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="A-instalasi-editor.html">
            
                <a href="A-instalasi-editor.html">
            
                    
                    A.5. Instalasi Editor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="A-go-command.html">
            
                <a href="A-go-command.html">
            
                    
                    A.6. Go Command
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="A-hello-world.html">
            
                <a href="A-hello-world.html">
            
                    
                    A.7. Program Pertama: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="A-komentar.html">
            
                <a href="A-komentar.html">
            
                    
                    A.8. Komentar
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9" data-path="A-variabel.html">
            
                <a href="A-variabel.html">
            
                    
                    A.9. Variabel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.10" data-path="A-tipe-data.html">
            
                <a href="A-tipe-data.html">
            
                    
                    A.10. Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.11" data-path="A-konstanta.html">
            
                <a href="A-konstanta.html">
            
                    
                    A.11. Konstanta
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.12" data-path="A-operator.html">
            
                <a href="A-operator.html">
            
                    
                    A.12. Operator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.13" data-path="A-seleksi-kondisi.html">
            
                <a href="A-seleksi-kondisi.html">
            
                    
                    A.13. Seleksi Kondisi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.14" data-path="A-perulangan.html">
            
                <a href="A-perulangan.html">
            
                    
                    A.14. Perulangan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.15" data-path="A-array.html">
            
                <a href="A-array.html">
            
                    
                    A.15. Array
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.16" data-path="A-slice.html">
            
                <a href="A-slice.html">
            
                    
                    A.16. Slice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.17" data-path="A-map.html">
            
                <a href="A-map.html">
            
                    
                    A.17. Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.18" data-path="A-fungsi.html">
            
                <a href="A-fungsi.html">
            
                    
                    A.18. Fungsi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.19" data-path="A-fungsi-multiple-return.html">
            
                <a href="A-fungsi-multiple-return.html">
            
                    
                    A.19. Fungsi Multiple Return
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.20" data-path="A-fungsi-variadic.html">
            
                <a href="A-fungsi-variadic.html">
            
                    
                    A.20. Fungsi Variadic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.21" data-path="A-fungsi-closure.html">
            
                <a href="A-fungsi-closure.html">
            
                    
                    A.21. Fungsi Closure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.22" data-path="A-fungsi-sebagai-parameter.html">
            
                <a href="A-fungsi-sebagai-parameter.html">
            
                    
                    A.22. Fungsi Sebagai parameter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.23" data-path="A-pointer.html">
            
                <a href="A-pointer.html">
            
                    
                    A.23. Pointer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.24" data-path="A-struct.html">
            
                <a href="A-struct.html">
            
                    
                    A.24. Struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.25" data-path="A-method.html">
            
                <a href="A-method.html">
            
                    
                    A.25. Method
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.26" data-path="A-properti-public-dan-private.html">
            
                <a href="A-properti-public-dan-private.html">
            
                    
                    A.26. Properti Public dan Private (Exported vs Unexported)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.27" data-path="A-interface.html">
            
                <a href="A-interface.html">
            
                    
                    A.27. Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.28" data-path="A-interface-kosong.html">
            
                <a href="A-interface-kosong.html">
            
                    
                    A.28. Any / interface{} / Interface Kosong
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.29" data-path="A-reflect.html">
            
                <a href="A-reflect.html">
            
                    
                    A.29. Reflect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.30" data-path="A-goroutine.html">
            
                <a href="A-goroutine.html">
            
                    
                    A.30. Goroutine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.31" data-path="A-channel.html">
            
                <a href="A-channel.html">
            
                    
                    A.31. Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.32" data-path="A-buffered-channel.html">
            
                <a href="A-buffered-channel.html">
            
                    
                    A.32. Buffered Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.33" data-path="A-channel-select.html">
            
                <a href="A-channel-select.html">
            
                    
                    A.33. Channel - Select
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.34" data-path="A-channel-range-close.html">
            
                <a href="A-channel-range-close.html">
            
                    
                    A.34. Channel - Range &amp; Close
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.35" data-path="A-channel-timeout.html">
            
                <a href="A-channel-timeout.html">
            
                    
                    A.35. Channel - Timeout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.36" data-path="A-defer-exit.html">
            
                <a href="A-defer-exit.html">
            
                    
                    A.36. Defer &amp; Exit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.37" data-path="A-error-panic-recover.html">
            
                <a href="A-error-panic-recover.html">
            
                    
                    A.37. Error, Panic, &amp; Recover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.38" data-path="A-string-format.html">
            
                <a href="A-string-format.html">
            
                    
                    A.38. Layout Format String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.39" data-path="A-random.html">
            
                <a href="A-random.html">
            
                    
                    A.39. Random
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.40" data-path="A-time-parsing-format.html">
            
                <a href="A-time-parsing-format.html">
            
                    
                    A.40. Time, Parsing Time, &amp; Format Time
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.41" data-path="A-timer-ticker-scheduler.html">
            
                <a href="A-timer-ticker-scheduler.html">
            
                    
                    A.41. Timer, Ticker, &amp; Scheduler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.42" data-path="A-time-duration.html">
            
                <a href="A-time-duration.html">
            
                    
                    A.42. Time Duration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.43" data-path="A-data-type-conversion.html">
            
                <a href="A-data-type-conversion.html">
            
                    
                    A.43. Konversi Antar Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.44" data-path="A-strings.html">
            
                <a href="A-strings.html">
            
                    
                    A.44. Fungsi String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.45" data-path="A-regex.html">
            
                <a href="A-regex.html">
            
                    
                    A.45. Regexp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.46" data-path="A-encoding-base64.html">
            
                <a href="A-encoding-base64.html">
            
                    
                    A.46. Encode - Decode Base64
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.47" data-path="A-hash-sha1.html">
            
                <a href="A-hash-sha1.html">
            
                    
                    A.47. Hash Sha1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.48" data-path="A-command-line-args-flag.html">
            
                <a href="A-command-line-args-flag.html">
            
                    
                    A.48. Arguments &amp; Flag
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.49" data-path="A-exec.html">
            
                <a href="A-exec.html">
            
                    
                    A.49. Exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.50" data-path="A-file.html">
            
                <a href="A-file.html">
            
                    
                    A.50. File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.51" data-path="A-web-server.html">
            
                <a href="A-web-server.html">
            
                    
                    A.51. Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.52" data-path="A-url-parsing.html">
            
                <a href="A-url-parsing.html">
            
                    
                    A.52. URL Parsing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.53" data-path="A-json.html">
            
                <a href="A-json.html">
            
                    
                    A.53. JSON Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.54" data-path="A-web-service-api.html">
            
                <a href="A-web-service-api.html">
            
                    
                    A.54. Web Service API Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.55" data-path="A-client-http-request-simple.html">
            
                <a href="A-client-http-request-simple.html">
            
                    
                    A.55. Simple Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.56" data-path="A-sql.html">
            
                <a href="A-sql.html">
            
                    
                    A.56. SQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.57" data-path="A-mongodb.html">
            
                <a href="A-mongodb.html">
            
                    
                    A.57. NoSQL MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.58" data-path="A-unit-test.html">
            
                <a href="A-unit-test.html">
            
                    
                    A.58. Unit Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.59" data-path="A-waitgroup.html">
            
                <a href="A-waitgroup.html">
            
                    
                    A.59. sync.WaitGroup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.60" data-path="A-mutex.html">
            
                <a href="A-mutex.html">
            
                    
                    A.60. sync.Mutex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.61" data-path="A-go-vendoring.html">
            
                <a href="A-go-vendoring.html">
            
                    
                    A.61. Go Vendoring
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.1.62" data-path="A-concurrency-pipeline.html">
            
                <a href="A-concurrency-pipeline.html">
            
                    
                    A.62. Concurrency Pattern: Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.63" data-path="A-simplified-fan-in-fan-out-pipeline.html">
            
                <a href="A-simplified-fan-in-fan-out-pipeline.html">
            
                    
                    A.63. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.64" data-path="A-pipeline-context-cancellation.html">
            
                <a href="A-pipeline-context-cancellation.html">
            
                    
                    A.64. Concurrency Pattern: Context Cancellation Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.65" data-path="A-golang-generics.html">
            
                <a href="A-golang-generics.html">
            
                    
                    A.65. Go Generics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1">
            
                <span>
            
                    
                    B. Pemrograman Web Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="B-golang-web-hello-world.html">
            
                <a href="B-golang-web-hello-world.html">
            
                    
                    B.1. Golang Web App: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="B-routing-http-handlefunc.html">
            
                <a href="B-routing-http-handlefunc.html">
            
                    
                    B.2. Routing http.HandleFunc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="B-routing-static-assets.html">
            
                <a href="B-routing-static-assets.html">
            
                    
                    B.3. Routing Static Assets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="B-template-render-html.html">
            
                <a href="B-template-render-html.html">
            
                    
                    B.4. Template: Render HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="B-template-render-partial-html.html">
            
                <a href="B-template-render-partial-html.html">
            
                    
                    B.5. Template: Render Partial HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="B-template-actions-variables.html">
            
                <a href="B-template-actions-variables.html">
            
                    
                    B.6. Template: Actions &amp; Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="B-template-functions.html">
            
                <a href="B-template-functions.html">
            
                    
                    B.7. Template: Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8" data-path="B-template-custom-functions.html">
            
                <a href="B-template-custom-functions.html">
            
                    
                    B.8. Template: Custom Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.9" data-path="B-render-specific-html-template.html">
            
                <a href="B-render-specific-html-template.html">
            
                    
                    B.9. Template: Render Specific HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.10" data-path="B-render-html-string.html">
            
                <a href="B-render-html-string.html">
            
                    
                    B.10. Template: Render HTML String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.11" data-path="B-http-method-basic.html">
            
                <a href="B-http-method-basic.html">
            
                    
                    B.11. HTTP Method: POST &amp; GET
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.12" data-path="B-form-value.html">
            
                <a href="B-form-value.html">
            
                    
                    B.12. Form Value
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.13" data-path="B-form-upload-file.html">
            
                <a href="B-form-upload-file.html">
            
                    
                    B.13. Form Upload File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.14" data-path="B-ajax-json-payload.html">
            
                <a href="B-ajax-json-payload.html">
            
                    
                    B.14. AJAX JSON Payload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.15" data-path="B-ajax-json-response.html">
            
                <a href="B-ajax-json-response.html">
            
                    
                    B.15. AJAX JSON Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.16" data-path="B-ajax-multi-upload.html">
            
                <a href="B-ajax-multi-upload.html">
            
                    
                    B.16. AJAX Multiple File Upload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.17" data-path="B-download-file.html">
            
                <a href="B-download-file.html">
            
                    
                    B.17. Download File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.18" data-path="B-http-basic-auth.html">
            
                <a href="B-http-basic-auth.html">
            
                    
                    B.18. HTTP Basic Auth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.19" data-path="B-middleware-using-http-handler.html">
            
                <a href="B-middleware-using-http-handler.html">
            
                    
                    B.19. Middleware http.Handler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.20" data-path="B-custom-mux-multiplexer.html">
            
                <a href="B-custom-mux-multiplexer.html">
            
                    
                    B.20. Custom Multiplexer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.21" data-path="B-cookie.html">
            
                <a href="B-cookie.html">
            
                    
                    B.21. HTTP Cookie
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.22" data-path="B-simple-configuration.html">
            
                <a href="B-simple-configuration.html">
            
                    
                    B.22. Simple Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.23" data-path="B-server-handler-http-request-cancellation.html">
            
                <a href="B-server-handler-http-request-cancellation.html">
            
                    
                    B.23. Server Handler HTTP Request Cancellation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1">
            
                <span>
            
                    
                    C. Pemrograman Go Lanjut
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="C-project-layout-structure.html">
            
                <a href="C-project-layout-structure.html">
            
                    
                    C.1. Project Layout Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="C-golang-web-framework.html">
            
                <a href="C-golang-web-framework.html">
            
                    
                    C.2. Go Web Framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="C-echo-routing.html">
            
                <a href="C-echo-routing.html">
            
                    
                    C.3. Echo Framework &amp; Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="C-parsing-http-request-payload-echo.html">
            
                <a href="C-parsing-http-request-payload-echo.html">
            
                    
                    C.4. Parsing HTTP Request Payload (Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.5" data-path="C-http-request-payload-validation.html">
            
                <a href="C-http-request-payload-validation.html">
            
                    
                    C.5. HTTP Request Payload Validation (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6" data-path="C-http-error-handling.html">
            
                <a href="C-http-error-handling.html">
            
                    
                    C.6. HTTP Error Handling (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7" data-path="C-echo-template-rendering.html">
            
                <a href="C-echo-template-rendering.html">
            
                    
                    C.7. Template Rendering in Echo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8" data-path="C-advanced-middleware-and-logging.html">
            
                <a href="C-advanced-middleware-and-logging.html">
            
                    
                    C.8. Advanced Middleware &amp; Logging (Logrus, Echo Logger)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.9" data-path="C-flag-parser.html">
            
                <a href="C-flag-parser.html">
            
                    
                    C.9. CLI Flag Parser (Kingpin)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.10" data-path="C-advanced-configuration-viper.html">
            
                <a href="C-advanced-configuration-viper.html">
            
                    
                    C.10. Advanced Configuration: Viper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11" data-path="C-best-practice-configuration-env-var.html">
            
                <a href="C-best-practice-configuration-env-var.html">
            
                    
                    C.11. Best Practice Configuration: Environment Variable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12" data-path="C-securecookie.html">
            
                <a href="C-securecookie.html">
            
                    
                    C.12. Secure Cookie (Gorilla Securecookie)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.13" data-path="C-session.html">
            
                <a href="C-session.html">
            
                    
                    C.13. Session (Gorilla Session)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14" data-path="C-cors-preflight-request.html">
            
                <a href="C-cors-preflight-request.html">
            
                    
                    C.14. CORS &amp; Preflight Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.15" data-path="C-csrf.html">
            
                <a href="C-csrf.html">
            
                    
                    C.15. CSRF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.16" data-path="C-secure-middleware.html">
            
                <a href="C-secure-middleware.html">
            
                    
                    C.16. Secure Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.17" data-path="C-http-gzip-compression.html">
            
                <a href="C-http-gzip-compression.html">
            
                    
                    C.17. HTTP Gzip Compression (gziphandler)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18" data-path="C-send-email.html">
            
                <a href="C-send-email.html">
            
                    
                    C.18. Send Mail (net/smtp, Gomail v2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19" data-path="C-read-write-excel-xlsx-file.html">
            
                <a href="C-read-write-excel-xlsx-file.html">
            
                    
                    C.19. Read &amp; Write Excel XLSX File (Excelize)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.20" data-path="C-write-pdf-file.html">
            
                <a href="C-write-pdf-file.html">
            
                    
                    C.20. Write PDF File (gofpdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.21" data-path="C-convert-html-to-pdf.html">
            
                <a href="C-convert-html-to-pdf.html">
            
                    
                    C.21. Convert HTML to PDF (go-wkhtmltopdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.22" data-path="C-scraping-parsing-html.html">
            
                <a href="C-scraping-parsing-html.html">
            
                    
                    C.22. Scraping &amp; Parsing HTML (goquery)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.23" data-path="C-xml-parser.html">
            
                <a href="C-xml-parser.html">
            
                    
                    C.23. Parse &amp; Generate XML (etree)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.24" data-path="C-https-tls.html">
            
                <a href="C-https-tls.html">
            
                    
                    C.24. HTTPS/TLS Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.25" data-path="C-http2-server-push.html">
            
                <a href="C-http2-server-push.html">
            
                    
                    C.25. HTTP/2 &amp; HTTP/2 Server Push
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.26" data-path="C-client-http-request-advanced.html">
            
                <a href="C-client-http-request-advanced.html">
            
                    
                    C.26. Advanced Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.27" data-path="C-secure-insecure-client-http-request.html">
            
                <a href="C-secure-insecure-client-http-request.html">
            
                    
                    C.27. Secure &amp; Insecure Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.28" data-path="C-golang-ftp.html">
            
                <a href="C-golang-ftp.html">
            
                    
                    C.28. FTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.29" data-path="C-golang-ssh-sftp.html">
            
                <a href="C-golang-ssh-sftp.html">
            
                    
                    C.29. SSH &amp; SFTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.30" data-path="C-golang-protobuf-implementation.html">
            
                <a href="C-golang-protobuf-implementation.html">
            
                    
                    C.30. Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.31" data-path="C-golang-grpc-protobuf.html">
            
                <a href="C-golang-grpc-protobuf.html">
            
                    
                    C.31. gRPC + Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.32" data-path="C-golang-jwt.html">
            
                <a href="C-golang-jwt.html">
            
                    
                    C.32. JSON Web Token (JWT)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.33" data-path="C-golang-ldap-authentication.html">
            
                <a href="C-golang-ldap-authentication.html">
            
                    
                    C.33. LDAP Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.34" data-path="C-golang-sso-saml-sp.html">
            
                <a href="C-golang-sso-saml-sp.html">
            
                    
                    C.34. SSO SAML (Service Provider)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.35" data-path="C-dockerize-golang.html">
            
                <a href="C-dockerize-golang.html">
            
                    
                    C.35. Dockerize Aplikasi Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.36" data-path="C-golang-redis.html">
            
                <a href="C-golang-redis.html">
            
                    
                    C.36. Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.37" data-path="C-singleflight.html">
            
                <a href="C-singleflight.html">
            
                    
                    C.37. Singleflight
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.38" data-path="C-golang-aws-s3.html">
            
                <a href="C-golang-aws-s3.html">
            
                    
                    C.38. AWS S3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="6.1">
            
                <span>
            
                    
                    D. Studi Kasus
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="D-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                <a href="D-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                    
                    D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="D-google-api-search.html">
            
                <a href="D-google-api-search.html">
            
                    
                    D.2. Google API Search Dengan Timeout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="D-golang-web-socket-chatting-app.html">
            
                <a href="D-golang-web-socket-chatting-app.html">
            
                    
                    D.3. Web Socket: Chatting App
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".">A.62. Concurrency Pattern: Pipeline</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h1 id="a62-concurrency-pattern-pipeline">A.62. Concurrency Pattern: Pipeline</h1>
<p>Kita sudah membahas beberapa kali tentang topik <em>concurrency</em> atau konkurensi di Go programming. Pada chapter ini kita akan belajar salah satu best practice konkurensi dalam Go, yaitu teknik <em>pipeline</em>, yang merupakan satu di antara banyak <em>concurrency pattern</em> yang ada di Go.</p>
<p>Go memiliki beberapa API untuk keperluan konkurensi, dua diantaranya adalah <em>goroutine</em> dan <em>channel</em>. Dengan memanfaatkan APIs yang ada kita bisa membentuk sebuah <em>streaming data pipeline</em> yang benefitnya adalah efisiensi penggunaan I/O dan efisiensi penggunaan banyak CPU.</p>
<h2 id="a621-konsep-pipeline">A.62.1. Konsep <em>Pipeline</em></h2>
<p>Definisi <em>pipeline</em> yang paling mudah versi penulis adalah <strong>beberapa/banyak proses yang berjalan secara konkuren yang masing-masing proses merupakan bagian dari serangkaian tahapan proses yang berhubungan satu sama lain</strong>.</p>
<p>Analoginya seperti ini: bayangkan sebuah flow proses untuk auto backup database secara rutin, yang mana database server yang perlu di-backup ada banyak. Untuk backup-nya sendiri kita menggunakan program Go, bukan <em>shell script</em>. Mungkin secara garis besar serangkaian tahapan proses yang akan dijalankan adalah berikut:</p>
<ol>
<li>Kita perlu data <em>list</em> dari semua database yang harus di-backup, beserta alamat akses dan kredensial-nya.</li>
<li>Kita jalankan proses backup, bisa secara sekuensial (setelah <code>db1</code> selesai, lanjut <code>db2</code>, lanjut <code>db3</code>, dst), atau secara paralel (proses backup <code>db1</code>, <code>db2</code>, <code>db3</code>, dan lainnya dijalankan secara bersamaan).</li>
<li><p>Di masing-masing proses backup database sendiri ada beberapa proses yang dijalankan:</p>
<ul>
<li>A. Lakukan operasi <em>dump</em> terhadap database, outputnya berupa banyak file disimpan ke sebuah folder.</li>
<li>B. File-file hasil dump kemudian di-<em>archive</em> ke bentuk <code>.zip</code> atau <code>.tar.gz</code> (misalnya).</li>
<li>C. File archive di-kirim ke server backup, sebagai contoh AWS S3.</li>
</ul>
</li>
</ol>
<p>Kalau diperhatikan pada kasus di atas, mungkin akan lebih bagus dari segi performansi kalau proses backup banyak database tersebut dilakukan secara parallel.</p>
<p>Dan akan lebih bagus lagi, jika di masing-masing proses backup database tersebut, proses A, B, dan C dijalankan secara konkuren. Dengan menjadikan ketiga proses tersebut (A, B, C) sebagai proses konkuren, maka I/O akan lebih efisien. Nantinya antara proses A, B, dan C eksekusinya akan tetap berurutan (karena memang harus berjalan secara urut. Tidak boleh kalau misal B lebih dulu dieksekusi kemudian A); akan tetapi, ketika goroutine yang bertanggung jawab untuk eksekusi proses A selesai, kita bisa lanjut dengan eksekusi proses B (yang memang <em>next stage</em>-nya proses A) plus eksekusi proses A lainnya (database lain) secara paralel. Jadi goroutine yang handle A ini ga sampai menganggur.</p>
<p>Silakan perhatikan visualisasi berikut. Kolom merupakan representasi dari goroutine yang berjalan secara bersamaan. Tapi karena ketiga goroutine tersebut merupakan serangkaian proses, sehingga eksekusinya harus secara berurut. Sedangkan baris/row representasi dari <em>sequence</em> atau urutan.</p>
<table>
<thead>
<tr>
<th style="text-align:center">sequence</th>
<th style="text-align:center">pipeline A</th>
<th style="text-align:center">pipeline B</th>
<th style="text-align:center">pipeline C</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">db1</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">db2</td>
<td style="text-align:center">db1</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">db3</td>
<td style="text-align:center">db1</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">db4</td>
<td style="text-align:center">db2</td>
<td style="text-align:center">db1</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">db5</td>
<td style="text-align:center">db3</td>
<td style="text-align:center">db2</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">db5</td>
<td style="text-align:center">db4</td>
<td style="text-align:center">db3</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">db6</td>
<td style="text-align:center">db5</td>
<td style="text-align:center">db4</td>
</tr>
<tr>
<td style="text-align:center">...</td>
<td style="text-align:center">...</td>
<td style="text-align:center">...</td>
<td style="text-align:center">...</td>
</tr>
</tbody>
</table>
<p>Di Go, umumnya proses yang berupa goroutine yang eksekusinya adalah concurrent tapi secara flow adalah harus berurutan, itu disebut dengan <strong>pipeline</strong>. Jadi untuk sementara anggap saja pipeline A sebuah goroutine untuk proses A, pipeline B adalah goroutine proses B, dst.</p>
<p>Untuk mempermudah memahami tabel di atas silakan ikuti penjelasan beruntun berikut:</p>
<ol>
<li>Sequence 1: pipeline A akan melakukan proses dump dari dari <code>db1</code>. Pada waktu yang sama, pipeline B dan C menganggur.</li>
<li>Sequence 2: proses dump <code>db1</code> telah selesai, maka lanjut ke <em>next stage</em> yaitu proses archive data dump <code>db1</code> yang dilakukan oleh pipeline B. Dan pada waktu yang sama juga, pipeline A menjalankan proses dump <code>db2</code>. Pipeline C masih menganggur.</li>
<li>Sequence 3: pipeline A menjalankan proses dump <code>db3</code>. Pada waktu yang sama pipeline B belum menjalankan proses archiving <code>db2</code> yang sudah di-dump karena archiving <code>db1</code> masih belum selesai. Pipeline C masih menganggur.</li>
<li>Sequence 4: proses archiving <code>db1</code> sudah selesai, maka lanjut ke <em>next stage</em> yaitu kirim archive ke server backup yang prosesnya di-handle oleh pipeline C. Pada saat yang sama, pipeline B mulai menjalankan archiving data dump <code>db2</code> dan pipeline A dumping <code>db4</code>.</li>
<li>... dan seterusnya.</li>
</ol>
<p>Pada contoh ini kita asumsikan pipeline A adalah hanya satu goroutine, pipeline B juga satu goroutine, demikian juga pipeline C. Tapi sebenarnya dalam implementasi <em>real world</em> bisa saja ada banyak goroutine untuk masing-masing pipeline (banyak goroutine untuk pipeline A, banyak goroutine untuk pipeline B, banyak goroutine untuk pipeline C).</p>
<p>Semoga cukup jelas ya. Tapi jika masih bingung, juga tidak apa. Kita sambil praktek juga, dan bisa saja pembaca mulai benar-benar pahamnya saat praktek.</p>
<blockquote>
<p>Penulis sarankan untuk benar-benar memahami setiap bagian praktek ini, karena topik ini merupakan pembahasan yang cukup berat untuk pemula, tapi masih dalam klasifikasi fundamental kalau di Go programming. Bingung tidak apa, nanti bisa di-ulang-ulang, yang penting tidak sekadar <em>copy-paste</em>.</p>
</blockquote>
<h2 id="a622-skenario-praktek">A.62.2. Skenario Praktek</h2>
<p>Ok, penjabaran teori sepanjang sungai <code>nil</code> tidak akan banyak membawa penjelasan yang real kalau tidak diiringi dengan praktek. So, mari kita mulai praktek.</p>
<p>Untuk skenario praktek kita tidak menggunakan analogi backup database di atas ya, karena untuk setup environment-nya butuh banyak <em>effort</em>. Skenario praktek yang kita pakai adalah mencari <a href="https://en.wikipedia.org/wiki/Md5sum" target="_blank">md5 sum</a> dari banyak file, kemudian menggunakan hash dari content-nya sebagai nama file. Jadi file yang lama akan di-rename dengan nama baru yaitu hash dari konten file tersebut.</p>
<p>Agar skenario ini bisa kita eksekusi, kita perlu siapkan dulu sebuah program untuk <em>generate dummy files</em>.</p>
<h2 id="a623-program-1-generate-dummy-file">A.62.3. Program 1: Generate Dummy File</h2>
<p>Buat project baru dengan nama bebas <span style="text-decoration: line-through">loss gak reweellll</span> beserta satu buah file bernama <code>1-dummy-file-generator.go</code>.</p>
<p>Dalam file tersebut import dan definisikan beberapa hal, diantaranya:</p>
<ol>
<li>Konstanta <code>totalFile</code> yang isinya jumlah file yang ingin di-generate.</li>
<li>Variabel <code>contentLength</code> yang isinya panjang karakter random yang merupakan isi dari masing-masing <em>generated</em> file.</li>
<li>Variabel <code>tempPath</code> yang mengarah ke <a href="https://en.wikipedia.org/wiki/Temporary_folder" target="_blank">temporary folder</a>.</li>
</ol>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;log&quot;</span>
    <span class="hljs-string">&quot;math/rand&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;path/filepath&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">const</span> totalFile = <span class="hljs-number">3000</span>
<span class="hljs-keyword">const</span> contentLength = <span class="hljs-number">5000</span>

<span class="hljs-keyword">var</span> tempPath = filepath.Join(os.Getenv(<span class="hljs-string">&quot;TEMP&quot;</span>), <span class="hljs-string">&quot;chapter-A.59-pipeline-temp&quot;</span>)
</code></pre>
<p>Kemudian siapkan fungsi <code>main()</code> yang isinya statement pemanggilan fungsi <code>generate()</code>, dan beberapa hal lainnya untuk keperluan <em>benchmark</em> performa dari sisi <em>execution time</em>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> main() {
    log.Println(<span class="hljs-string">&quot;start&quot;</span>)
    start := time.Now()

    generateFiles()

    duration := time.Since(start)
    log.Println(<span class="hljs-string">&quot;done in&quot;</span>, duration.Seconds(), <span class="hljs-string">&quot;seconds&quot;</span>)
}
</code></pre>
<p>Sekarang siapkan fungsi <code>randomString()</code>-nya:</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> randomString(length <span class="hljs-keyword">int</span>) <span class="hljs-keyword">string</span> {
    randomizer := rand.New(rand.NewSource(time.Now().Unix()))
    letters := []<span class="hljs-keyword">rune</span>(<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>)

    b := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">rune</span>, length)
    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> b {
        b[i] = letters[randomizer.Intn(<span class="hljs-built_in">len</span>(letters))]
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>(b)
}
</code></pre>
<p>Siapkan fungsi <code>generateFiles()</code>-nya, isinya kurang lebih adalah generate banyak file sejumlah <code>totalFile</code>. Lalu di tiap-tiap file di-isi dengan <em>random string</em> dengan lebar sepanjang <code>contentLength</code>. Untuk nama file-nya sendiri, formatnya adalah <code>file-&lt;index&gt;.txt</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> generateFiles() {
    os.RemoveAll(tempPath)
    os.MkdirAll(tempPath, os.ModePerm)

    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; totalFile; i++ {
        filename := filepath.Join(tempPath, fmt.Sprintf(<span class="hljs-string">&quot;file-%d.txt&quot;</span>, i))
        content := randomString(contentLength)
        err := os.WriteFile(filename, []<span class="hljs-keyword">byte</span>(content), os.ModePerm)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            log.Println(<span class="hljs-string">&quot;Error writing file&quot;</span>, filename)
        }

        <span class="hljs-keyword">if</span> i%<span class="hljs-number">100</span> == <span class="hljs-number">0</span> &amp;&amp; i &gt; <span class="hljs-number">0</span> {
            log.Println(i, <span class="hljs-string">&quot;files created&quot;</span>)
        }
    }

    log.Printf(<span class="hljs-string">&quot;%d of total files created&quot;</span>, totalFile)
}
</code></pre>
<p>O iya untuk logging pembuatan file saya tampilkan setiap 100 file di-generate, agar tidak mengganggu performa, karena printing output ke <code>stdout</code> atau CMD/terminal itu cukup <em>costly</em>.</p>
<p>Oke, generator sudah siap, jalankan.</p>
<p><img src="images/A_concurrency_pipeline_1_generate_dummy_files.png" alt="Dasar Pemrograman Golang - Generate dummy files"></p>
<p>Bisa dilihat sebanyak 3000 dummy file di-generate pada folder temporary os, di sub folder <code>chapter-A.59-pipeline-temp</code>.</p>
<h2 id="a624-program-2-baca-semua-files-cari-md5-hash-nya-lalu-gunakan-hash-untuk-rename-file">A.62.4. Program 2: Baca Semua Files, Cari MD5 Hash-nya, Lalu Gunakan Hash Untuk Rename File</h2>
<p>Sesuai judul sub bagian, kita akan buat satu file program lagi, yang isinya adalah melakukan operasi baca terhadap semua dummy file yang sudah di-generate, untuk kemudian dicari <em>hash</em>-nya lalu menggunakan nilai hash tersebut sebagai nama untuk file-file baru yang akan dibuat.</p>
<p>Pada bagian ini kita belum masuk ke aspek konkurensi-nya ya. Sabar dulu. Saya akan coba sampaikan dengan penjabaran yang bisa diterima oleh banyak pembaca (termasuk yang masih awam banget).</p>
<p>Siapkan file <code>2-find-md5-sum-of-file-then-rename-it.go</code>, import beberapa <em>packages</em> dan siapkan definisi variabel <code>tempPath</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;crypto/md5&quot;</span>
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;log&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;path/filepath&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">var</span> tempPath = filepath.Join(os.Getenv(<span class="hljs-string">&quot;TEMP&quot;</span>), <span class="hljs-string">&quot;chapter-A.59-pipeline-temp&quot;</span>)
</code></pre>
<p>Lanjut siapkan fungsi <code>main()</code> dengan isi memanggil fungsi <code>proceed()</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> main() {
    log.Println(<span class="hljs-string">&quot;start&quot;</span>)
    start := time.Now()

    proceed()

    duration := time.Since(start)
    log.Println(<span class="hljs-string">&quot;done in&quot;</span>, duration.Seconds(), <span class="hljs-string">&quot;seconds&quot;</span>)
}
</code></pre>
<p>Isi dari fungsi <code>proceed()</code> sendiri adalah bisnis logic dari aplikasi yang akan kita buat, yaitu membaca file, mencari md5 hash, lalu rename file.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> proceed() {
    counterTotal := <span class="hljs-number">0</span>
    counterRenamed := <span class="hljs-number">0</span>
    err := filepath.Walk(tempPath, <span class="hljs-keyword">func</span>(path <span class="hljs-keyword">string</span>, info os.FileInfo, err error) error {

        <span class="hljs-comment">// if there is an error, return immediatelly</span>
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> err
        }

        <span class="hljs-comment">// if it is a sub directory, return immediatelly</span>
        <span class="hljs-keyword">if</span> info.IsDir() {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        }

        counterTotal++

        <span class="hljs-comment">// read file</span>
        buf, err := os.ReadFile(path)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> err
        }

        <span class="hljs-comment">// sum it</span>
        sum := fmt.Sprintf(<span class="hljs-string">&quot;%x&quot;</span>, md5.Sum(buf))

        <span class="hljs-comment">// rename file</span>
        destinationPath := filepath.Join(tempPath, fmt.Sprintf(<span class="hljs-string">&quot;file-%s.txt&quot;</span>, sum))
        err = os.Rename(path, destinationPath)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> err
        }

        counterRenamed++
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    })
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Println(<span class="hljs-string">&quot;ERROR:&quot;</span>, err.Error())
    }

    log.Printf(<span class="hljs-string">&quot;%d/%d files renamed&quot;</span>, counterRenamed, counterTotal)
}
</code></pre>
<p>Cukup panjang isi fungsi ini, tetapi isinya cukup <em>straight forward</em> kok.</p>
<ul>
<li>Pertama kita siapkan <code>counterTotal</code> sebagai counter jumlah file yang ditemukan dalam <code>$TEMP/chapter-A.59-pipeline-temp</code>. Idealnya jumlahnya adalah sama dengan isi variabel <code>totalFile</code> pada program pertama, kecuali ada error.</li>
<li>Kedua, kita siapkan <code>counterRenamed</code> sebagai counter jumlah file yang berhasil di-rename. Untuk ini juga idealnya sama dengan nilai pada <code>counterTotal</code>, kecuali ada error</li>
<li>Kita gunakan <code>filepath.Walk</code> untuk melakukan pembacaan semua file yang ada dalam folder <code>$TEMP/chapter-A.59-pipeline-temp</code>.</li>
<li>File akan dibaca secara sekuensial, di tiap pembacaan jika ada error dan ditemukan sebuah direktori, maka kita ignore kemudian lanjut pembacaan file selanjutnya.</li>
<li>File dibaca menggunakan <code>os.ReadFile()</code>, kemudian lewat fungsi <code>md5.Sum()</code> kita cari md5 hash sum dari konten file.</li>
<li>Setelahnya, kita rename file dengan nama <code>file-&lt;md5hash&gt;.txt</code>.</li>
</ul>
<p>Semoga cukup jelas. Kalo iya, jalankan programnya.</p>
<p><img src="images/A_concurrency_pipeline_2_rename_sequentially.png" alt="Dasar Pemrograman Golang - Generate dummy files"></p>
<p>Selesai dalam waktu <strong>1,17 detik</strong>, lumayan untuk eksekusi proses sekuensial.</p>
<p>Ok, aplikasi sudah siap. Selanjutnya kita akan refactor aplikasi tersebut ke bentuk konkuren menggunakan metode <em>pipeline</em>.</p>
<h2 id="a625-program-3-lakukan-proses-secara-concurrent-menggunakan-teknik-pipeline">A.62.5. Program 3: Lakukan Proses Secara Concurrent Menggunakan Teknik Pipeline</h2>
<p>Pada bagian ini kita akan re-write ulang program 2, isinya masih sama persis kalau dilihat dari perspektif bisnis logic, tapi metode yang kita terapkan dari sisi engineering berbeda. Di sini kita akan terapkan <em>pipeline</em>. Bisnis logic akan dipecah menjadi 3 dan seluruhnya dieksekusi secara konkuren, yaitu:</p>
<ul>
<li>Proses baca file</li>
<li>Proses perhitungan md5 hash sum</li>
<li>Proses rename file</li>
</ul>
<p>Kenapa kita pecah, karena ketiga proses tersebut bisa dijalankan bersama secara konkuren, dalam artian misalnya ketika <code>file1</code> sudah selesai dibaca, perhitungan md5sum-nya bisa dijalankan secara bersama dengan pembacaan <code>file2</code>. Begitu juga untuk proses rename-nya, misalnya, proses rename <code>file24</code> bisa dijalnkan secara konkuren bersamaan dengan proses hitung md5sum <code>file22</code> dan bersamaan dengan proses baca <code>file28</code>.</p>
<h4 id="&#x25C9;-basis-kode-program">&#x25C9; Basis Kode Program</h4>
<p>Mungkin agar lebih terlihat perbandingannya nanti di akhir, kita siapkan file terpisah saja untuk program ini. Siapkan file baru bernama <code>3-find-md5-sum-of-file-then-rename-it-concurrently.go</code>.</p>
<p>Isi file tersebut dengan kode berikut.</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;crypto/md5&quot;</span>
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;log&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;path/filepath&quot;</span>
    <span class="hljs-string">&quot;sync&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">var</span> tempPath = filepath.Join(os.Getenv(<span class="hljs-string">&quot;TEMP&quot;</span>), <span class="hljs-string">&quot;chapter-A.59-pipeline-temp&quot;</span>)

<span class="hljs-keyword">type</span> FileInfo <span class="hljs-keyword">struct</span> {
    FilePath  <span class="hljs-keyword">string</span> <span class="hljs-comment">// file location</span>
    Content   []<span class="hljs-keyword">byte</span> <span class="hljs-comment">// file content</span>
    Sum       <span class="hljs-keyword">string</span> <span class="hljs-comment">// md5 sum of content</span>
    IsRenamed <span class="hljs-keyword">bool</span>   <span class="hljs-comment">// indicator whether the particular file is renamed already or not</span>
}
</code></pre>
<p>Kurang lebih sama seperti sebelumnya, hanya saja ada beberapa packages lain yg di-import dan ada struct <code>FileInfo</code>. Struct ini digunakan sebagai metadata tiap file. Karena nantinya proses read file, md5sum, dan rename file akan dipecah menjadi 3 goroutine berbeda, maka perlu ada metadata untuk mempermudah tracking file, agar nanti ketika dapat md5 sum nya tidak salah simpan, dan ketika rename tidak salah file.</p>
<h4 id="&#x25C9;-pipeline-1-baca-file">&#x25C9; Pipeline 1: Baca File</h4>
<p>Siapkan fungsi main, lalu panggil fungsi <code>readFiles()</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> main() {
    log.Println(<span class="hljs-string">&quot;start&quot;</span>)
    start := time.Now()

    <span class="hljs-comment">// pipeline 1: loop all files and read it</span>
    chanFileContent := readFiles()

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Fungsi <code>readFiles()</code> isinya adalah pembacaan semua file. Fungsi ini mengembalikan variabel <code>channel</code> bernama <code>chanFileContent</code>. Lanjut siapkan fungsi tersebut.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> readFiles() &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        err := filepath.Walk(tempPath, <span class="hljs-keyword">func</span>(path <span class="hljs-keyword">string</span>, info os.FileInfo, err error) error {

            <span class="hljs-comment">// if there is an error, return immediatelly</span>
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                <span class="hljs-keyword">return</span> err
            }

            <span class="hljs-comment">// if it is a sub directory, return immediatelly</span>
            <span class="hljs-keyword">if</span> info.IsDir() {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
            }

            buf, err := os.ReadFile(path)
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                <span class="hljs-keyword">return</span> err
            }

            chanOut &lt;- FileInfo{
                FilePath: path,
                Content:  buf,
            }

            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        })
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            log.Println(<span class="hljs-string">&quot;ERROR:&quot;</span>, err.Error())
        }

        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<p>Bisa dilihat isi fungsi <code>readFiles()</code>. Di fungsi tersebut ada sebuah channel bernama <code>chanOut</code> tipenya channel <code>FileInfo</code>, variabel channel ini dijadikan nilai balik dari fungsi <code>readFiles()</code>.</p>
<p>Di dalam fungsi <code>readFiles()</code> juga ada proses lain yang berjalan secara <em>asynchronous</em> dan <em>concurrent</em> yaitu goroutine yang isinya pembacaan file. Dalam blok kode baca file, informasi <code>path</code> dan konten file dibungkus dalam objek baru dengan tipe <code>FileInfo</code> kemudian dikirim ke channel <code>chanOut</code>.</p>
<p>Karena proses utama dalam fungsi <code>readFiles()</code> berada dalam goroutine, maka di <code>main()</code>, ketika statement <code>chanFileContent := readFiles()</code> selesai dieksekusi, bukan berarti proses pembacaan file selesai, malah mungkin baru saja dimulai. Ini karena proses baca file dijalankan dalam goroutine di dalam fungsi <code>readFiles()</code> tersebut.</p>
<p>Mengenai channel <code>chanOut</code> sendiri, akan di-close ketika dipastikan <strong>semua file sudah dikirim datanya ke channel tersebut</strong> (silakan lihat statement <code>close(chanOut)</code> di akhir goroutine).</p>
<p>Ok lanjut, karena di sini ada channel yang digunakan sebagai media pengiriman data (<code>FileInfo</code>), maka juga harus ada penerima data channel-nya dong. Yups.</p>
<h4 id="&#x25C9;-pipeline-2-md5-hash-konten-file">&#x25C9; Pipeline 2: MD5 Hash Konten File</h4>
<p>Tepat di bawah pipeline 1, tambahkan pemanggilan fungsi <code>getSum()</code> sebanyak 3x, bisa lebih banyak sih sebenarnya, bebas. Kemudian jadikan nilai balik pemanggilan fungsi tersebut sebagai variadic argument pemanggilan fungsi <code>mergeChanFileInfo()</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> main() {
    <span class="hljs-comment">// ...</span>

    <span class="hljs-comment">// pipeline 2: calculate md5sum</span>
    chanFileSum1 := getSum(chanFileContent)
    chanFileSum2 := getSum(chanFileContent)
    chanFileSum3 := getSum(chanFileContent)
    chanFileSum := mergeChanFileInfo(chanFileSum1, chanFileSum2, chanFileSum3)

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Fungsi <code>getSum()</code> isinya adalah perhitungan md5hash untuk konten yang datanya dikirim via channel <code>chanFileContent</code> hasil kembalian statement <code>readFiles()</code>. Fungsi <code>getSum()</code> ini juga mengembalikan channel. Karena kita menjalankan <code>getSum()</code> tiga kali, maka akan ada 3 channel. Nah ketiga channel tersebut nantinya kita merge ke satu channel saja via fungsi <code>mergeChanFileInfo()</code>.</p>
<p>Fungsi <code>getSum()</code> menerima channel dan akan secara aktif memantau dan membaca data yang dikirim via channel tersebut hingga channel itu sendiri di-close. Fungsi seperti ini biasa disebut dengan <strong>Fan-out function</strong>. Fungsi fan-out digunakan untuk pendistribusian job ke banyak worker. channel <code>chanFileContent</code> di situ merupakan media untuk distribusi job, sedangkan pemanggil fungsi <code>getSum()</code> ini sendiri merepresentasikan satu worker. Jadi bisa dibilang, pada contoh di atas, <strong>kita membuat 3 buah worker untuk melakukan operasi perhitungan sum MD5 terhadap data konten yang dikirim via channel <code>chanFileContent</code></strong>.</p>
<p>Nah, karena di sini kita punya 3 worker yang jelasnya menghasilkan 3 buah channel baru, kita perlu sebuah mekanisme untuk menggabung channel tersebut, agar nanti mudah untuk dikontrol (<a href="https://en.wikipedia.org/wiki/Single_source_of_truth" target="_blank">SSoT</a>). Di sinilah peran fungsi <code>mergeChanFileInfo()</code>.</p>
<p>Fungsi <code>mergeChanFileInfo()</code> digunakan untuk <em>multiplexing</em> atau menggabung banyak channel ke satu channel saja, yang mana channel ini juga akan <strong>otomatis di-close ketika channel input (<code>chanFileContent</code>) adalah <em>closed</em></strong>. Fungsi jenis seperti ini biasa disebut dengan <strong>Fan-in function</strong>.</p>
<p>Jadi TL;DR nya:</p>
<ul>
<li>Fungsi Fan-out digunakan untuk pembuatan worker, untuk distribusi job, yang proses distribusinya sendiri akan berhenti ketika channel inputan di-close.</li>
<li>Fungsi Fan-in digunakan untuk <em>multiplexing</em> atau menggabung banyak worker ke satu channel saja, yang mana channel baru ini juga otomatis di-close ketika channel input adalah closed.</li>
</ul>
<p>Sekarang lanjut buat fungsi <code>getSum()</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> getSum(chanIn &lt;-<span class="hljs-keyword">chan</span> FileInfo) &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">for</span> fileInfo := <span class="hljs-keyword">range</span> chanIn {
            fileInfo.Sum = fmt.Sprintf(<span class="hljs-string">&quot;%x&quot;</span>, md5.Sum(fileInfo.Content))
            chanOut &lt;- fileInfo
        }
        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<p>Bisa dilihat, di situ channel inputan <code>chanIn</code> di-listen dan setiap ada penerimaan data (via channel tersebut) dilanjut ke proses kalkulasi md5 hash. Hasil hash-nya di tambahkan ke data <code>FileInfo</code> kemudian dikirim lagi ke channel <code>chanOut</code> yang mana channel ini merupakan nilai balik fungsi <code>getSum()</code>.</p>
<p>Ketika <code>chanIn</code> closed, maka bisa diasumsikan semua data sudah dikirim. Jika memang iya dan data-data tersebut sudah di proses (pencarian md5hash-nya), maka channel <code>chanOut</code> juga di-close.</p>
<p>Next, buat fungsi merger-nya.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> mergeChanFileInfo(chanInMany ...&lt;-<span class="hljs-keyword">chan</span> FileInfo) &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    wg := <span class="hljs-built_in">new</span>(sync.WaitGroup)
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    wg.Add(<span class="hljs-built_in">len</span>(chanInMany))
    <span class="hljs-keyword">for</span> _, eachChan := <span class="hljs-keyword">range</span> chanInMany {
        <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>(eachChan &lt;-<span class="hljs-keyword">chan</span> FileInfo) {
            <span class="hljs-keyword">for</span> eachChanData := <span class="hljs-keyword">range</span> eachChan {
                chanOut &lt;- eachChanData
            }
            wg.Done()
        }(eachChan)
    }

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        wg.Wait()
        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<p>Fungsi di atas digunakan untuk merging banyak channel ke satu channel. Memang sedikit susah di awal untuk dipahami, tapi nanti lama-kelamaan akan paham. Fungsi ini saya buat sama dengan skema fungsi Fan-in pada <a href="https://blog.golang.org/pipelines" target="_blank">Go Concurrency Patterns: Pipeline</a>.</p>
<p>Secara garis besar, pada fungsi ini terjadi beberapa proses:</p>
<ul>
<li>Dispatch goroutine baru untuk masing-masing channel yang dikirim via variadic argument/parameter fungsi ini.</li>
<li>Di dalam goroutine tersebut, append data yang diterima oleh masing-masing channel ke satu buah channel baru yaitu <code>chanOut</code>.</li>
<li>Channel <code>chanOut</code> ini dijadikan sebagai nilai balik fungsi.</li>
<li>Di situ kita gunakan <code>sync.WaitGroup</code> untuk kontrol goroutine. Kita akan tunggu hingga semua channel input adalah closed, setelah itu barulah kita close channel <code>chanOut</code> ini.</li>
</ul>
<h4 id="&#x25C9;-pipeline-3-rename-file">&#x25C9; Pipeline 3: Rename file</h4>
<p>Tambahkan statement pipeline ketiga, yaitu pemanggilan fungsi Fan-out <code>rename()</code>, lalu panggil fungsi Fan-in <code>mergeChanFileInfo()</code> untuk multiplex channel kembalian fungsi <code>rename()</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> main() {
    <span class="hljs-comment">// ...</span>

    <span class="hljs-comment">// pipeline 3: rename files</span>
    chanRename1 := rename(chanFileSum)
    chanRename2 := rename(chanFileSum)
    chanRename3 := rename(chanFileSum)
    chanRename4 := rename(chanFileSum)
    chanRename := mergeChanFileInfo(chanRename1, chanRename2, chanRename3, chanRename4)

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Di atas bisa dilihat ada 4 buah worker untuk rename di-<em>dispatch</em>. Fungsi rename ini sendiri tugasnya adalah me-rename file yang sudah kita baca isinya ke nama baru dengan format <code>file-&lt;md5hash&gt;.txt</code>.</p>
<p>Tulis definisi fungsi <code>rename()</code>-nya. Secara garis besar semua penulisan fungsi Fan-out pasti mirip, yang beda hanya isi bisnis logic-nya saja. Kalau dalam <code>getSum()</code> isinya statement untuk kalkulasi hash, pada <code>rename()</code> ini isinya ya statements untuk rename file.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> rename(chanIn &lt;-<span class="hljs-keyword">chan</span> FileInfo) &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">for</span> fileInfo := <span class="hljs-keyword">range</span> chanIn {
            newPath := filepath.Join(tempPath, fmt.Sprintf(<span class="hljs-string">&quot;file-%s.txt&quot;</span>, fileInfo.Sum))
            err := os.Rename(fileInfo.FilePath, newPath)
            fileInfo.IsRenamed = err == <span class="hljs-literal">nil</span>
            chanOut &lt;- fileInfo
        }

        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<p>Bisa dilihat di atas kita rename file asli yang informasi path-nya ada di <code>FileInfo.FilePath</code>. Jika proses rename berhasil, maka <code>FileInfo.IsRenamed</code> di-set ke <code>true</code>.</p>
<p>Setelah semua file berhasil di-rename, maka channel <code>chanOut</code> di-close.</p>
<h4 id="&#x25C9;-pipeline-4--output">&#x25C9; Pipeline 4 / Output</h4>
<p>Serangkaian proses yang sudah kita setup punya ketergantungan tinggi satu sama lain, dan eksekusinya harus berurutan meskipun <em>concurrently</em>. Ini secara langsung juga mempermudah kita dalam mengolah output hasil pipeline. Kita cukup fokus ke channel hasil Fan-in yang paling terakhir, yaitu channel <code>chanRename</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> main() {
    <span class="hljs-comment">// ...</span>

    <span class="hljs-comment">// print output</span>
    counterRenamed := <span class="hljs-number">0</span>
    counterTotal := <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> fileInfo := <span class="hljs-keyword">range</span> chanRename {
        <span class="hljs-keyword">if</span> fileInfo.IsRenamed {
            counterRenamed++
        }
        counterTotal++
    }

    log.Printf(<span class="hljs-string">&quot;%d/%d files renamed&quot;</span>, counterRenamed, counterTotal)

    duration := time.Since(start)
    log.Println(<span class="hljs-string">&quot;done in&quot;</span>, duration.Seconds(), <span class="hljs-string">&quot;seconds&quot;</span>)
}
</code></pre>
<p>Kita lakukan perulangan terhadap channel tersebut, lalu hitung jumlah file yang ditemukan vs jumlah file yang berhasil di-rename. Idealnya keduanya nilainya adalah sama, yaitu <code>3000</code>.</p>
<p>Ok, sekarang program sudah siap. Mari kita jalankan untuk melihat hasilnya.</p>
<p><img src="images/A_concurrency_pipeline_3_rename_concurrently.png" alt="Dasar Pemrograman Golang - Rename file concurrently"></p>
<p>Bisa dilihat bedanya, untuk rename 3000 file menggunakan cara sekuensial membutuhkan waktu <code>1.17</code> detik, sedangkan dengan metode pipeline butuh hanya <code>0.72</code> detik. Bedanya hampir <strong>40%</strong>! dan ini hanya 3000 file saja, bayangkan kalau jutaan file, mungkin lebih terasa perbandingan performnya.</p>
<h2 id="a626-kesimpulan">A.62.6. Kesimpulan</h2>
<p>Pipeline concurrency pattern sangat bagus untuk diterapkan pada case yang proses-nya bisa diklasifikasi menjadi sub-proses kecil-kecil yang secara I/O tidak saling tunggu (tapi secara flow harus berurutan).</p>
<p>Untuk banyak kasus, metode pipeline ini sangat tepat guna. Kita bisa dengan mudah mengontrol penggunaan resource seperti <strong>CPU</strong> dengan cara menentukan angka ideal jumlah worker untuk masing-masing pipeline, tapi untuk bagian ini butuh <em>test and try</em> juga, karena tidak selalu banyak worker itu menghasilkan proses yang lebih cepat, dan misalpun bisa, perlu dicek juga konsumsi resource-nya berlebihan atau tidak. Bisa jadi karena terlalu banyak worker malah lebih lambat karena ada constraint I/O.</p>
<p>Intinya butuh banyak percobaan dan testing, sesuaikan dengan spesifikasi hardware laptop/komputer/server yang digunakan.</p>
<p>Ok sekian untuk chapter panjang ini.</p>
<hr>
<div class="source-code-link">
    <div class="source-code-link-message">Source code praktik chapter ini tersedia di Github</div>
    <a href="https://github.com/novalagung/dasarpemrogramangolang-example/tree/master/chapter-A.62-concurrency-pipeline" target="_blank">https://github.com/novalagung/dasarpemrogramangolang-example/.../chapter-A.62...</a>
</div>

<hr>
<iframe src="partial/ebooks.html" width="100%" height="390px" frameborder="0" scrolling="no"></iframe>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="A-go-vendoring.html" class="navigation navigation-prev " aria-label="Previous page: A.61. Go Vendoring">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="A-simplified-fan-in-fan-out-pipeline.html" class="navigation navigation-next " aria-label="Next page: A.63. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"A.62. Concurrency Pattern: Pipeline","level":"3.1.62","depth":2,"next":{"title":"A.63. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline","level":"3.1.63","depth":2,"path":"A-simplified-fan-in-fan-out-pipeline.md","ref":"A-simplified-fan-in-fan-out-pipeline.md","articles":[]},"previous":{"title":"A.61. Go Vendoring","level":"3.1.61","depth":2,"path":"A-go-vendoring.md","ref":"A-go-vendoring.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["-search","-lunr","docsearch-v3","disqus","meta","sitemap"],"pluginsConfig":{"docsearch":{"appId":"ZV0MXP90GF","apiKey":"f7431c709385fe300da4c2ef2093c43c","indexName":"dasarpemrogramangolang-novalagung"},"disqus":{"useIdentifier":false,"shortName":"dasarpemrogramangolang"},"meta":{"name":"","content":"","data":[{"name":"google-site-verification","content":"UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"},{"name":"og:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"},{"name":"twitter:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"}]},"docsearch-v3":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sitemap":{"hostname":"https://dasarpemrogramangolang.novalagung.com/"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":10,"left":10,"top":56,"bottom":56}},"styles":{"website":"style-website-v4.css"}},"file":{"path":"A-concurrency-pipeline.md","mtime":"2024-12-14T16:54:09.617Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-12-14T16:55:01.942Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-docsearch-v3/init.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-disqus/plugin.js?3.2024.12.14.165522"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    <div style="position: fixed; top: 5px; right: 30px; padding: 10px; background-color: rgba(255, 255, 255, 0.7);">
			<a class="github-button" href="https://github.com/sponsors/novalagung" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-heart" data-size="large" aria-label="Sponsor @novalagung on GitHub">Sponsor</a>&nbsp;
			<a class="github-button" href="https://github.com/novalagung/dasarpemrogramangolang" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star novalagung/dasarpemrogramangolang on GitHub">Star</a>&nbsp;
			<a class="github-button" href="https://github.com/novalagung" data-size="large" aria-label="Follow @novalagung on GitHub">Follow @novalagung</a>
			<script async defer src="https://buttons.github.io/buttons.js"></script>
		</div></body>
</html>