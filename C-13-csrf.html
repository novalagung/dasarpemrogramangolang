<!DOCTYPE HTML><html lang=""><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>C.13. Golang CSRF - Dasar Pemrograman Golang</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><script data-ad-client="ca-pub-1417781814120840" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-1417781814120840", enable_page_level_ads: true }); </script><meta content="GitBook 3.2.3"name="generator"><link href="gitbook/style.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-disqus/plugin.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-highlight/website.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><link href="adjustment.css"rel="stylesheet"><meta content="UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"name="google-site-verification"><meta content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"name="og:image"><meta content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"name="twitter:image"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="C-14-secure-middleware.html"rel="next"/><link href="C-12-cors-preflight-request.html"rel="prev"/><script async defer src="https://buttons.github.io/buttons.js"></script></head><body><div class="book"><div class="book-summary"><div role="search"id="book-search-input"><input placeholder="Type to search"type="text"/></div><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="./"><a href="./">Introduction</a></li><li class="chapter"data-level="1.2"data-path="CONTRIBUTORS.html"><a href="CONTRIBUTORS.html">Contributors</a></li><li class="chapter"data-level="1.3"><span>A. Pemrograman Go Dasar</span><ul class="articles"><li class="chapter"data-level="1.3.1"data-path="1-berkenalan-dengan-golang.html"><a href="1-berkenalan-dengan-golang.html">A.1. Berkenalan Dengan Golang</a></li><li class="chapter"data-level="1.3.2"data-path="2-instalasi-golang.html"><a href="2-instalasi-golang.html">A.2. Instalasi Golang</a></li><li class="chapter"data-level="1.3.3"data-path="3-gopath-dan-workspace.html"><a href="3-gopath-dan-workspace.html">A.3. GOPATH Dan Workspace</a></li><li class="chapter"data-level="1.3.4"data-path="4-instalasi-editor.html"><a href="4-instalasi-editor.html">A.4. Instalasi Editor</a></li><li class="chapter"data-level="1.3.5"data-path="5-go-command.html"><a href="5-go-command.html">A.5. Command</a></li><li class="chapter"data-level="1.3.6"data-path="6-hello-world.html"><a href="6-hello-world.html">A.6. Program Pertama: Hello World</a></li><li class="chapter"data-level="1.3.7"data-path="7-komentar.html"><a href="7-komentar.html">A.7. Komentar</a></li><li class="chapter"data-level="1.3.8"data-path="8-variabel.html"><a href="8-variabel.html">A.8. Variabel</a></li><li class="chapter"data-level="1.3.9"data-path="9-tipe-data.html"><a href="9-tipe-data.html">A.9. Tipe Data</a></li><li class="chapter"data-level="1.3.10"data-path="10-konstanta.html"><a href="10-konstanta.html">A.10. Konstanta</a></li><li class="chapter"data-level="1.3.11"data-path="11-operator.html"><a href="11-operator.html">A.11. Operator</a></li><li class="chapter"data-level="1.3.12"data-path="12-seleksi-kondisi.html"><a href="12-seleksi-kondisi.html">A.12. Seleksi Kondisi</a></li><li class="chapter"data-level="1.3.13"data-path="13-perulangan.html"><a href="13-perulangan.html">A.13. Perulangan</a></li><li class="chapter"data-level="1.3.14"data-path="14-array.html"><a href="14-array.html">A.14. Array</a></li><li class="chapter"data-level="1.3.15"data-path="15-slice.html"><a href="15-slice.html">A.15. Slice</a></li><li class="chapter"data-level="1.3.16"data-path="16-map.html"><a href="16-map.html">A.16. Map</a></li><li class="chapter"data-level="1.3.17"data-path="17-fungsi.html"><a href="17-fungsi.html">A.17. Fungsi</a></li><li class="chapter"data-level="1.3.18"data-path="18-fungsi-multiple-return.html"><a href="18-fungsi-multiple-return.html">A.18. Fungsi Multiple Return</a></li><li class="chapter"data-level="1.3.19"data-path="19-fungsi-variadic.html"><a href="19-fungsi-variadic.html">A.19. Fungsi Variadic</a></li><li class="chapter"data-level="1.3.20"data-path="20-fungsi-closure.html"><a href="20-fungsi-closure.html">A.20. Fungsi Closure</a></li><li class="chapter"data-level="1.3.21"data-path="21-fungsi-sebagai-parameter.html"><a href="21-fungsi-sebagai-parameter.html">A.21. Fungsi Sebagai parameter</a></li><li class="chapter"data-level="1.3.22"data-path="22-pointer.html"><a href="22-pointer.html">A.22. Pointer</a></li><li class="chapter"data-level="1.3.23"data-path="23-struct.html"><a href="23-struct.html">A.23. Struct</a></li><li class="chapter"data-level="1.3.24"data-path="24-method.html"><a href="24-method.html">A.24. Method</a></li><li class="chapter"data-level="1.3.25"data-path="25-properti-public-dan-private.html"><a href="25-properti-public-dan-private.html">A.25. Property Public & Private</a></li><li class="chapter"data-level="1.3.26"data-path="26-interface.html"><a href="26-interface.html">A.26. Interface</a></li><li class="chapter"data-level="1.3.27"data-path="27-interface-kosong.html"><a href="27-interface-kosong.html">A.27. Interface Kosong</a></li><li class="chapter"data-level="1.3.28"data-path="28-reflect.html"><a href="28-reflect.html">A.28. Reflect</a></li><li class="chapter"data-level="1.3.29"data-path="29-goroutine.html"><a href="29-goroutine.html">A.29. Goroutine</a></li><li class="chapter"data-level="1.3.30"data-path="30-channel.html"><a href="30-channel.html">A.30. Channel</a></li><li class="chapter"data-level="1.3.31"data-path="31-buffered-channel.html"><a href="31-buffered-channel.html">A.31. Buffered Channel</a></li><li class="chapter"data-level="1.3.32"data-path="32-channel-select.html"><a href="32-channel-select.html">A.32. Channel - Select</a></li><li class="chapter"data-level="1.3.33"data-path="33-channel-range-close.html"><a href="33-channel-range-close.html">A.33. Channel - Range & Close</a></li><li class="chapter"data-level="1.3.34"data-path="34-channel-timeout.html"><a href="34-channel-timeout.html">A.34. Channel - Timeout</a></li><li class="chapter"data-level="1.3.35"data-path="35-defer-exit.html"><a href="35-defer-exit.html">A.35. Defer & Exit</a></li><li class="chapter"data-level="1.3.36"data-path="36-error-panic-recover.html"><a href="36-error-panic-recover.html">A.36. Error, Panic, & Recover</a></li><li class="chapter"data-level="1.3.37"data-path="37-string-format.html"><a href="37-string-format.html">A.37. Layout Format String</a></li><li class="chapter"data-level="1.3.38"data-path="38-time.html"><a href="38-time.html">A.38. Time, Parsing Time, & Format Time</a></li><li class="chapter"data-level="1.3.39"data-path="39-timer.html"><a href="39-timer.html">A.39. Timer, Ticker, & Scheduler</a></li><li class="chapter"data-level="1.3.40"data-path="40-data-type-conversion.html"><a href="40-data-type-conversion.html">A.40. Konversi Antar Tipe Data</a></li><li class="chapter"data-level="1.3.41"data-path="41-strings.html"><a href="41-strings.html">A.41. Fungsi String</a></li><li class="chapter"data-level="1.3.42"data-path="42-regex.html"><a href="42-regex.html">A.42. Regex</a></li><li class="chapter"data-level="1.3.43"data-path="43-encoding-base64.html"><a href="43-encoding-base64.html">A.43. Encode - Decode Base64</a></li><li class="chapter"data-level="1.3.44"data-path="44-hash-sha1.html"><a href="44-hash-sha1.html">A.44. Hash Sha1</a></li><li class="chapter"data-level="1.3.45"data-path="45-command-line-args-flag.html"><a href="45-command-line-args-flag.html">A.45. Arguments & Flag</a></li><li class="chapter"data-level="1.3.46"data-path="46-exec.html"><a href="46-exec.html">A.46. Exec</a></li><li class="chapter"data-level="1.3.47"data-path="47-file.html"><a href="47-file.html">A.47. File</a></li><li class="chapter"data-level="1.3.48"data-path="48-web.html"><a href="48-web.html">A.48. Web</a></li><li class="chapter"data-level="1.3.49"data-path="49-url-parsing.html"><a href="49-url-parsing.html">A.49. URL Parsing</a></li><li class="chapter"data-level="1.3.50"data-path="50-json.html"><a href="50-json.html">A.50. JSON</a></li><li class="chapter"data-level="1.3.51"data-path="51-web-json-api.html"><a href="51-web-json-api.html">A.51. Web Service API (JSON Data)</a></li><li class="chapter"data-level="1.3.52"data-path="52-http-request.html"><a href="52-http-request.html">A.52. HTTP Request</a></li><li class="chapter"data-level="1.3.53"data-path="53-sql.html"><a href="53-sql.html">A.53. SQL</a></li><li class="chapter"data-level="1.3.54"data-path="54-mongodb.html"><a href="54-mongodb.html">A.54. NoSQL MongoDB</a></li><li class="chapter"data-level="1.3.55"data-path="55-unit-test.html"><a href="55-unit-test.html">A.55. Unit Test</a></li><li class="chapter"data-level="1.3.56"data-path="56-waitgroup.html"><a href="56-waitgroup.html">A.56. WaitGroup</a></li><li class="chapter"data-level="1.3.57"data-path="57-mutex.html"><a href="57-mutex.html">A.57. Mutex</a></li><li class="chapter"data-level="1.3.58"data-path="A-58-go-vendoring.html"><a href="A-58-go-vendoring.html">A.58. Go Vendoring</a></li><li class="chapter"data-level="1.3.59"data-path="A-59-go-dep.html"><a href="A-59-go-dep.html">A.59. Dep - Go Dependency Management Tool</a></li><li class="chapter"data-level="1.3.60"data-path="A-60-go-modules.html"><a href="A-60-go-modules.html">A.60. Go Modules</a></li></ul></li><li class="chapter"data-level="1.4"><span>B. Pemrograman Web Go Dasar</span><ul class="articles"><li class="chapter"data-level="1.4.1"data-path="B-1-golang-web-hello-world.html"><a href="B-1-golang-web-hello-world.html">B.1. Golang Web App: Hello World</a></li><li class="chapter"data-level="1.4.2"data-path="B-2-routing-http-handlefunc.html"><a href="B-2-routing-http-handlefunc.html">B.2. Routing http.HandleFunc</a></li><li class="chapter"data-level="1.4.3"data-path="B-3-routing-static-assets.html"><a href="B-3-routing-static-assets.html">B.3. Routing Static Assets</a></li><li class="chapter"data-level="1.4.4"data-path="B-4-template-render-html.html"><a href="B-4-template-render-html.html">B.4. Template: Render HTML Template</a></li><li class="chapter"data-level="1.4.5"data-path="B-5-template-render-partial-html.html"><a href="B-5-template-render-partial-html.html">B.5. Template: Render Partial HTML Template</a></li><li class="chapter"data-level="1.4.6"data-path="B-6-template-actions-variables.html"><a href="B-6-template-actions-variables.html">B.6. Template: Actions & Variables</a></li><li class="chapter"data-level="1.4.7"data-path="B-7-template-functions.html"><a href="B-7-template-functions.html">B.7. Template: Functions</a></li><li class="chapter"data-level="1.4.8"data-path="B-8-template-custom-functions.html"><a href="B-8-template-custom-functions.html">B.8. Template: Custom Functions</a></li><li class="chapter"data-level="1.4.9"data-path="B-9-render-specific-html-template.html"><a href="B-9-render-specific-html-template.html">B.9. Template: Render Specific HTML Template</a></li><li class="chapter"data-level="1.4.10"data-path="B-10-render-html-string.html"><a href="B-10-render-html-string.html">B.10. Template: Render HTML String</a></li><li class="chapter"data-level="1.4.11"data-path="B-11-http-method.html"><a href="B-11-http-method.html">B.11. HTTP Method: POST & GET</a></li><li class="chapter"data-level="1.4.12"data-path="B-12-form-value.html"><a href="B-12-form-value.html">B.12. Form Value</a></li><li class="chapter"data-level="1.4.13"data-path="B-13-form-upload-file.html"><a href="B-13-form-upload-file.html">B.13. Form Upload File</a></li><li class="chapter"data-level="1.4.14"data-path="B-14-ajax-json-payload.html"><a href="B-14-ajax-json-payload.html">B.14. AJAX JSON Payload</a></li><li class="chapter"data-level="1.4.15"data-path="B-15-ajax-json-response.html"><a href="B-15-ajax-json-response.html">B.15. AJAX JSON Response</a></li><li class="chapter"data-level="1.4.16"data-path="B-16-ajax-multi-upload.html"><a href="B-16-ajax-multi-upload.html">B.16. AJAX Multiple File Upload</a></li><li class="chapter"data-level="1.4.17"data-path="B-17-download-file.html"><a href="B-17-download-file.html">B.17. Download File</a></li><li class="chapter"data-level="1.4.18"data-path="B-18-http-basic-auth.html"><a href="B-18-http-basic-auth.html">B.18. HTTP Basic Auth</a></li><li class="chapter"data-level="1.4.19"data-path="B-19-middleware-using-http-handler.html"><a href="B-19-middleware-using-http-handler.html">B.19. Middleware http.Handler</a></li><li class="chapter"data-level="1.4.20"data-path="B-20-custom-mux-multiplexer.html"><a href="B-20-custom-mux-multiplexer.html">B.20. Custom Multiplexer</a></li><li class="chapter"data-level="1.4.21"data-path="B-21-cookie.html"><a href="B-21-cookie.html">B.21. HTTP Cookie</a></li><li class="chapter"data-level="1.4.22"data-path="B-22-configuration-file.html"><a href="B-22-configuration-file.html">B.22. Configuration File</a></li><li class="chapter"data-level="1.4.23"data-path="B-23-server-handle-cancelled-http-request.html"><a href="B-23-server-handle-cancelled-http-request.html">B.23. Cancelled HTTP Request Handler</a></li></ul></li><li class="chapter"data-level="1.5"><span>C. Pemrograman Go Lanjut</span><ul class="articles"><li class="chapter"data-level="1.5.1"data-path="C-1-echo-routing.html"><a href="C-1-echo-routing.html">C.1. Echo Framework & Routing</a></li><li class="chapter"data-level="1.5.2"data-path="C-2-parsing-http-request-payload-echo.html"><a href="C-2-parsing-http-request-payload-echo.html">C.2. Parsing HTTP Request Payload (Echo)</a></li><li class="chapter"data-level="1.5.3"data-path="C-3-http-request-payload-validation.html"><a href="C-3-http-request-payload-validation.html">C.3. HTTP Request Payload Validation (Validator v9, Echo)</a></li><li class="chapter"data-level="1.5.4"data-path="C-4-http-error-handling.html"><a href="C-4-http-error-handling.html">C.4. HTTP Error Handling (Validator v9, Echo)</a></li><li class="chapter"data-level="1.5.5"data-path="C-5-echo-template-rendering.html"><a href="C-5-echo-template-rendering.html">C.5. Template Rendering in Echo</a></li><li class="chapter"data-level="1.5.6"data-path="C-6-advanced-middleware-and-logging.html"><a href="C-6-advanced-middleware-and-logging.html">C.6. Advanced Middleware & Logging (Logrus, Echo Logger)</a></li><li class="chapter"data-level="1.5.7"data-path="C-7-flag-parser.html"><a href="C-7-flag-parser.html">C.7. CLI Flag Parser (Kingpin)</a></li><li class="chapter"data-level="1.5.8"data-path="C-8-advanced-configuration-file.html"><a href="C-8-advanced-configuration-file.html">C.8. Advanced Configuration File (Viper)</a></li><li class="chapter"data-level="1.5.9"data-path="C-9-securecookie.html"><a href="C-9-securecookie.html">C.9. Secure Cookie (Gorilla Securecookie)</a></li><li class="chapter"data-level="1.5.10"data-path="C-10-session.html"><a href="C-10-session.html">C.10. Session (Gorilla Session)</a></li><li class="chapter"data-level="1.5.11"data-path="C-12-cors-preflight-request.html"><a href="C-12-cors-preflight-request.html">C.12. CORS & Preflight Request</a></li><li class="chapter active"data-level="1.5.12"data-path="C-13-csrf.html"><a href="C-13-csrf.html">C.13. CSRF</a></li><li class="chapter"data-level="1.5.13"data-path="C-14-secure-middleware.html"><a href="C-14-secure-middleware.html">C.14. Secure Middleware</a></li><li class="chapter"data-level="1.5.14"data-path="C-15-http-gzip-compression.html"><a href="C-15-http-gzip-compression.html">C.15. HTTP Gzip Compression (gziphandler)</a></li><li class="chapter"data-level="1.5.15"data-path="C-16-send-email.html"><a href="C-16-send-email.html">C.16. Send Mail (net/smtp, Gomail v2)</a></li><li class="chapter"data-level="1.5.16"data-path="C-17-read-write-excel-xlsx-file.html"><a href="C-17-read-write-excel-xlsx-file.html">C.17. Read & Write Excel XLSX File (Excelize)</a></li><li class="chapter"data-level="1.5.17"data-path="C-18-write-pdf-file.html"><a href="C-18-write-pdf-file.html">C.18. Write PDF File (gofpdf)</a></li><li class="chapter"data-level="1.5.18"data-path="C-19-convert-html-to-pdf.html"><a href="C-19-convert-html-to-pdf.html">C.19. Convert HTML to PDF (go-wkhtmltopdf)</a></li><li class="chapter"data-level="1.5.19"data-path="C-20-scraping-parsing-html.html"><a href="C-20-scraping-parsing-html.html">C.20. Scraping & Parsing HTML (goquery)</a></li><li class="chapter"data-level="1.5.20"data-path="C-21-xml-parser.html"><a href="C-21-xml-parser.html">C.21. Parse & Generate XML (etree)</a></li><li class="chapter"data-level="1.5.21"data-path="C-22-https-tls.html"><a href="C-22-https-tls.html">C.22. HTTPS/TLS Web Server</a></li><li class="chapter"data-level="1.5.22"data-path="C-23-http2-server-push.html"><a href="C-23-http2-server-push.html">C.23. HTTP/2 & HTTP/2 Server Push</a></li><li class="chapter"data-level="1.5.23"data-path="C-24-client-http-request.html"><a href="C-24-client-http-request.html">C.24. Client HTTP Request</a></li><li class="chapter"data-level="1.5.24"data-path="C-25-secure-insecure-client-http-request.html"><a href="C-25-secure-insecure-client-http-request.html">C.25. Secure & Insecure Client HTTP Request</a></li><li class="chapter"data-level="1.5.25"data-path="C-26-golang-ftp.html"><a href="C-26-golang-ftp.html">C.26. FTP</a></li><li class="chapter"data-level="1.5.26"data-path="C-27-golang-ssh-sftp.html"><a href="C-27-golang-ssh-sftp.html">C.27. SSH & SFTP</a></li><li class="chapter"data-level="1.5.27"data-path="C-28-golang-web-socket.html"><a href="C-28-golang-web-socket.html">C.28. Web Socket: Chatting App</a></li><li class="chapter"data-level="1.5.28"data-path="C-29-golang-protobuf-implementation.html"><a href="C-29-golang-protobuf-implementation.html">C.29. Protobuf</a></li><li class="chapter"data-level="1.5.29"data-path="C-30-golang-grpc-protobuf.html"><a href="C-30-golang-grpc-protobuf.html">C.30. gRPC + Protobuf</a></li><li class="chapter"data-level="1.5.30"data-path="C-31-golang-context.html"><a href="C-31-golang-context.html">C.31. Context: Value, Timeout, & Cancellation</a></li><li class="chapter"data-level="1.5.31"data-path="C-32-golang-jwt.html"><a href="C-32-golang-jwt.html">C.32. JSON Web Token (JWT)</a></li><li class="chapter"data-level="1.5.32"data-path="C-33-golang-ldap-authentication.html"><a href="C-33-golang-ldap-authentication.html">C.33. LDAP Authentication</a></li><li class="chapter"data-level="1.5.33"data-path="C-34-golang-sso-saml-sp.html"><a href="C-34-golang-sso-saml-sp.html">C.34. SSO SAML (Service Provider)</a></li></ul></li><li class="chapter"data-level="1.6"><span>D. Studi Kasus</span><ul class="articles"><li class="chapter"data-level="1.6.1"data-path="D-1-insert-1mil-csv-record-into-db-in-a-minute.html"><a href="D-1-insert-1mil-csv-record-into-db-in-a-minute.html">D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover</a></li></ul></li><li><a href="https://www.gitbook.com"target="blank"class="gitbook-link">Published with GitBook</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><a href=".">C.13. CSRF</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><h1 id="c13-csrf">C.13. CSRF</h1><p>Pada bab ini kita akan belajar tentang serangan Cross-Site Request Forgery (CSRF) dan cara mengatisipasinya.</p><h2 id="c131-teori">C.13.1. Teori</h2><p>Cross-Site Request Forgery atau CSRF adalah salah satu teknik hacking yang dilakukan dengan cara mengeksekusi perintah yang seharusnya tidak diizinkan, tetapi output yang dihasilkan sesuai dengan yang seharusnya. Contoh serangan jenis ini: mencoba untuk login lewat media selain web browser, seperti menggunakan CURL, menembak langsung endpoint login. Masih banyak contoh lainnya yang lebih ekstrim.</p><p>Ada beberapa cara untuk mencegah serangan ini, salah satunya adalah dengan memanfaatkan csrf token. Di setiap halaman yang ada form nya, csrf token di-generate. Pada saat submit form, csrf disisipkan di request, lalu di sisi back end dilakukan pengecekan apakah csrf yang dikirim valid atau tidak.</p><p>Csrf token sendiri merupakan sebuah random string yang di-generate setiap kali halaman form muncul. Biasanya di tiap POST request, token tersebut disisipkan sebagai header, atau form data, atau query string.</p><p>Lebih detailnya silakan merujuk ke <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery"target="_blank">https://en.wikipedia.org/wiki/Cross-site_request_forgery</a>.</p><h2 id="c132-praktek-back-end">C.13.2. Praktek: Back End</h2><p>Di golang, pencegahan CSRF bisa dilakukan dengan membuat middleware untuk pengecekan setiap request POST yang masuk. Cukup mudah sebenarnya, namun agar lebih mudah lagi kita akan gunakan salah satu middleware milik echo framework untuk belajar.</p><p>Di setiap halaman, jika di dalam html nya terdapat form, maka harus disisipkan token csrf. Token tersebut di-generate oleh middleware.</p><p>Di tiap POST request hasil dari form submit, token tersebut harus ikut dikirimkan. Proses validasi token sendiri di-handle oleh middleware.</p><p>Mari kita praktekkan, siapkan projek baru. Buat file <code>main.go</code>, isi dengan kode berikut.</p><pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;github.com/labstack/echo&quot;</span>
    <span class="hljs-string">&quot;github.com/labstack/echo/middleware&quot;</span>
    <span class="hljs-string">&quot;html/template&quot;</span>
    <span class="hljs-string">&quot;net/http&quot;</span>
)

<span class="hljs-keyword">type</span> M <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">interface</span>{}

<span class="hljs-keyword">func</span> main() {
    tmpl := template.Must(template.ParseGlob(<span class="hljs-string">&quot;./*.html&quot;</span>))

    e := echo.New()

    <span class="hljs-comment">// ...</span>

    e.Logger.Fatal(e.Start(<span class="hljs-string">&quot;:9000&quot;</span>))
}
</code></pre><p>Nantinya akan ada endpoint <code>/index</code>, isinya menampilkan html form. Objek <code>tmpl</code> kita gunakan untuk rendering form tersebut. API echo renderer tidak digunakan dalam bab ini.</p><p>Siapkan routing untuk <code>/index</code>, dan registrasikan middleware CSRF.</p><pre><code class="lang-go"><span class="hljs-keyword">const</span> CSRFTokenHeader = <span class="hljs-string">&quot;X-CSRF-Token&quot;</span>
<span class="hljs-keyword">const</span> CSRFKey = <span class="hljs-string">&quot;csrf&quot;</span>

e.Use(middleware.CSRFWithConfig(middleware.CSRFConfig{
    TokenLookup: <span class="hljs-string">&quot;header:&quot;</span> + CSRFTokenHeader,
    ContextKey:  CSRFKey,
}))

e.GET(<span class="hljs-string">&quot;/index&quot;</span>, <span class="hljs-keyword">func</span>(c echo.Context) error {
    data := <span class="hljs-built_in">make</span>(M)
    data[CSRFKey] = c.Get(CSRFKey)
    <span class="hljs-keyword">return</span> tmpl.Execute(c.Response(), data)
})
</code></pre><p>Objek middleware CSRF dibuat lewat statement <code>middleware.CSRF()</code>, konfigurasi default digunakan. Atau bisa juga dibuat dengan disertakan konfigurasi custom, lewat <code>middleware.CSRFWithConfig()</code> seperti pada kode di atas.</p><p>Property <code>ContextKey</code> digunakan untuk mengakses token csrf yang tersimpan di <code>echo.Context</code>, pembuatan token sendiri terjadi pada saat ada http request GET masuk.</p><p>Property tersebut kita isi dengan konstanta <code>CSRFKey</code>, maka dalam pengambilan token cukup panggil <code>c.Get(CSRFKey)</code>. Token kemudian disisipkan sebagai data pada saat rendering <code>view.html</code>.</p><p>Property <code>TokenLookup</code> adalah acuan di bagian mana informasi csrf disisipkan dalam objek request, apakah dari header, query string, atau form data. Ini penting karena dibutuhkan oleh middleware yang bersangkutan untuk memvalidasi token tersebut. Bisa dilihat, kita memilih <code>header:X-CSRF-Token</code>, artinya csrf token dalam request akan disisipkan dalam header dengan key adalah <code>X-CSRF-Token</code>.</p><blockquote><p>Isi value <code>TokenLookup</code> dengan <code>&quot;form:&lt;name&gt;&quot;</code> jika token disispkan dalam form data request, dan <code>&quot;query:&lt;name&gt;&quot;</code> jika token disisipkan dalam query string.</p></blockquote><p>Selanjutnya siapkan satu endpoint lagi, yaitu <code>/sayhello</code>, endpoint ini nantinya menjadi tujuan request yang di-dispatch dari event submit form.</p><pre><code class="lang-go">e.POST(<span class="hljs-string">&quot;/sayhello&quot;</span>, <span class="hljs-keyword">func</span>(c echo.Context) error {
    data := <span class="hljs-built_in">make</span>(M)
    <span class="hljs-keyword">if</span> err := c.Bind(&amp;data); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }

    message := fmt.Sprintf(<span class="hljs-string">&quot;hello %s&quot;</span>, data[<span class="hljs-string">&quot;name&quot;</span>])
    <span class="hljs-keyword">return</span> c.JSON(http.StatusOK, message)
})
</code></pre><p>Pada handler endpoint <code>/sayhello</code> tidak ada pengecekan token csrf, karena sudah ditangani secara implisit oleh middleware.</p><h2 id="c133-front-end">C.13.3. Front End</h2><p>Buat <code>view.html</code>, lalu isi kode berikut.</p><pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;form&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/sayhello&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Name<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Type your name here&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Gender<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;gender&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>Select one<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;male&quot;</span>&gt;</span>Male<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;female&quot;</span>&gt;</span>Female<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;csrf&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;{{ .csrf }}&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="actionscript">
        <span class="hljs-comment">// JS code here ...</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre><p>Bisa dilihat, sebuah form disiapkan dengan isi 2 inputan dan satu buah tombol submit.</p><p>Sebenarnya ada tiga inputan, namun yang satu adalah hidden. Inputan tersebut berisi nilai <code>csrf</code> yang disisipkan dari back end.</p><p>Pada saat tombol submit di-klik, token tersebut harus disisipkan dalam AJAX request yang mengarah ke <code>/sayhello</code>.</p><p>Sekarang buat script JS-nya. Siapkan sebuah event listener <code>submit</code> untuk element <code>form</code>, isinya adalah AJAX. Ambil informasi inputan nama dan gender, jadikan sebagai payload AJAX tersebut.</p><pre><code class="lang-js">$(<span class="hljs-function"><span class="hljs-keyword">function</span> () </span>{
    $(<span class="hljs-string">&apos;form&apos;</span>).on(<span class="hljs-string">&apos;submit&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
        e.preventDefault()

        <span class="hljs-keyword">var</span> self = $(<span class="hljs-keyword">this</span>)

        <span class="hljs-keyword">var</span> formData = {
            name: self.find(<span class="hljs-string">&apos;[name=&quot;name&quot;]&apos;</span>).val(),
            gender: self.find(<span class="hljs-string">&apos;[name=&quot;gender&quot;]&apos;</span>).val(),
        }

        <span class="hljs-keyword">var</span> url = self.attr(<span class="hljs-string">&apos;action&apos;</span>)
        <span class="hljs-keyword">var</span> method = self.attr(<span class="hljs-string">&apos;method&apos;</span>)
        <span class="hljs-keyword">var</span> payload = <span class="hljs-built_in">JSON</span>.stringify(formData)

        $.ajax({
            url: url,
            type: method,
            contentType: <span class="hljs-string">&apos;application/json&apos;</span>,
            data: payload,
            beforeSend: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req</span>) </span>{
                <span class="hljs-keyword">var</span> csrfToken = self.find(<span class="hljs-string">&apos;[name=csrf]&apos;</span>).val()
                req.setRequestHeader(<span class="hljs-string">&quot;X-CSRF-Token&quot;</span>, csrfToken)
            },
        }).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) </span>{
            alert(res)
        }).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
            alert(<span class="hljs-string">&apos;ERROR: &apos;</span> + err.responseText)
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;err&apos;</span>, err)
        })
    })
})
</code></pre><p>Tambahkan header <code>X-CSRF-Token</code> di AJAX request seperti pada kode di atas, isinya diambil dari inputan hidden <code>csrf</code>. Nama header sendiri menggunakan <code>X-CSRF-Token</code>.</p><p>Karena di konfigurasi middleware csrf di back end <code>TokenLookup</code> adalah <code>header:X-CSRF-Token</code>, maka header dengan nama <code>X-CSRF-Token</code> dipilih.</p><h2 id="c134-testing">C.13.4. Testing</h2><p>Sekarang jalankan aplikasi lalu akses <code>/index</code> untuk mengetes hasilnya. Silakan melakukan skenario testing berikut.</p><ol><li>Buka laman <code>/index</code>, form akan muncul.</li><li>Pada saat rendering output <code>/index</code>, disisipkan juga token csrf yang di-generate oleh middleware pada saat endpoint ini diakses.</li><li>OK, sekarang laman form sudah muncul.</li><li>Isi inputan form.</li><li>Klik tombol submit.</li><li>Di event submit tersebut, sebuah AJAX dipersiapkan dengan tujuan adalah <code>/sayhello</code>.</li><li>Di dalam AJAX ini, token csrf yang sebelumnya disisipkan, diambil lalu ditempelkan ke AJAX.</li><li>AJAX di-dispatch ke <code>/sayhello</code>.</li><li>Sebelum benar-benar diterima oleh handler endpoint, middleware secara otomatis melakukan pengecekan atas token csrf yang disisipkan.</li><li>Jika pengecekan sukses, maka request diteruskan ke tujuan.</li><li>Jika tidak suses, error message dikembalikan.</li><li>Pengecekan adalah sukses, alert message muncul.</li></ol><p>Hasilnya:</p><p><img alt="CSRF test result"src="images/C.13_1_csrf.png"></p><p>Coba tembak langsung endpoint nya lewat CURL.</p><pre><code class="lang-bash">$ curl -X POST http://localhost:9000/sayhello \
     -H <span class="hljs-string">&apos;Content-Type: application/json&apos;</span> \
     <span class="hljs-_">-d</span> <span class="hljs-string">&apos;{&quot;name&quot;:&quot;noval&quot;,&quot;gender&quot;:&quot;male&quot;}&apos;</span>
</code></pre><p><img alt="CSRF test curl"src="images/C.13_2_csrf_curl.png"></p><p>Hasilnya error, karena token csrf tidak di-sisipkan.</p><p>Lewat teknik pencegahan ini, bukan berarti serangan CSRF tidak bisa dilakukan, si hacker masih bisa menembak endpoint secara paksa lewat CURL, hanya saja membutuhkan usaha ekstra jika ingin sukses.</p><hr><ul><li><a href="https://github.com/labstack/echo"target="_blank">Echo</a>, by Vishal Rana (Lab Stack), MIT license</li></ul><hr><div class="source-code-link"><div class="source-code-link-message">Source code praktek pada bab ini tersedia di Github</div><a href="https://github.com/novalagung/dasarpemrogramangolang-example/tree/master/chapter-C.13-csrf"target="_blank">https://github.com/novalagung/dasarpemrogramangolang-example/.../chapter-C.13...</a></div></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title">results matching ""</h1></div><div class="no-results"><h1 class="search-results-title">No results matching ""</h1></div></div></div></div></div></div><a href="C-12-cors-preflight-request.html"class="navigation navigation-prev"aria-label="Previous page: C.12. CORS & Preflight Request"></a><a href="C-14-secure-middleware.html"class="navigation navigation-next"aria-label="Next page: C.14. Secure Middleware"></a></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{title:"C.13. CSRF",level:"1.5.12",depth:2,next:{title:"C.14. Secure Middleware",level:"1.5.13",depth:2,path:"C-14-secure-middleware.md",ref:"C-14-secure-middleware.md",articles:[]},previous:{title:"C.12. CORS & Preflight Request",level:"1.5.11",depth:2,path:"C-12-cors-preflight-request.md",ref:"C-12-cors-preflight-request.md",articles:[]},dir:"ltr"},config:{plugins:["ga","html-minifier","disqus","meta","sitemap"],styles:{website:"adjustment.css"},pluginsConfig:{disqus:{useIdentifier:!1,shortName:"dasarpemrogramangolang"},meta:{content:"",data:[{name:"google-site-verification",content:"UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"},{name:"og:image",content:"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"},{name:"twitter:image",content:"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"}],name:""},search:{},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!0,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},fontsettings:{theme:"white",family:"sans",size:2},highlight:{},sitemap:{hostname:"https://dasarpemrogramangolang.novalagung.com/"},ga:{configuration:"auto",token:"UA-27602984-29"},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1}},theme:"default",lunr:{maxIndexSize:1e9},pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},variables:{},gitbook:"*"},file:{path:"C-13-csrf.md",mtime:"2020-04-24T04:21:35.749Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2020-04-24T04:22:34.310Z"},basePath:".",book:{language:""}})})</script></div><script src="gitbook/gitbook.js"></script><script src="gitbook/theme.js"></script><script src="gitbook/gitbook-plugin-ga/plugin.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script><script src="gitbook/gitbook-plugin-disqus/plugin.js"></script><script src="gitbook/gitbook-plugin-search/search-engine.js"></script><script src="gitbook/gitbook-plugin-search/search.js"></script><script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script><div style="position: fixed; top: 10px; right: 30px; padding: 10px; background-color: rgba(255, 255, 255, 0.7);"><a class="github-button" href="https://github.com/novalagung/dasarpemrogramangolang" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star novalagung/dasarpemrogramangolang on GitHub">Star</a>&nbsp;<a class="github-button" href="https://github.com/novalagung" data-size="large" aria-label="Follow @novalagung on GitHub">Follow @novalagung</a><script async defer src="https://buttons.github.io/buttons.js"></script></div><a href="https://devops.novalagung.com/" target="_blank" class="book-news">Hi all, I just released another ebook. This new one focus on devops implementation of various stacks rather than specific programming topic, and the good news it is available on Bahasa and English languages. Only few articles have been published, more are coming. Have a look! https://devops.novalagung.com/</a></body></html>