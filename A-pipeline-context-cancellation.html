
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Golang Concurrency Pattern: Context Cancellation Pipeline - Dasar Pemrograman Golang</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-disqus/plugin.css" media="print" onload="this.media='all'">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css" media="print" onload="this.media='all'">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css" media="print" onload="this.media='all'">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css" media="print" onload="this.media='all'">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta  name="google-site-verification"  content="UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE" >
    
    <meta  name="og:image"  content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg" >
    
    <meta  name="twitter:image"  content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg" >
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="A-simplified-fan-in-fan-out-pipeline.html" />
    


    <link rel="stylesheet" href="gitbook/adjustment.css?v=2.2020.11.05.082927"><script async defer src="https://buttons.github.io/buttons.js"></script></head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Dasar Pemrograman Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="CONTRIBUTORS.html">
            
                <a href="CONTRIBUTORS.html">
            
                    
                    Kontributor
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <a target="_blank" href="https://www.udemy.com/course/praktis-belajar-docker-dan-kubernetes-untuk-pemula/?couponCode=BIGSALENOVEMBER">
            
                    
                    Course Mendeploy Aplikasi Go ke Docker dan Kubernetes (PROMO!)
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    A. Pemrograman Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="1-berkenalan-dengan-golang.html">
            
                <a href="1-berkenalan-dengan-golang.html">
            
                    
                    A.1. Belajar Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="2-instalasi-golang.html">
            
                <a href="2-instalasi-golang.html">
            
                    
                    A.2. Instalasi Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="A-setup-go-project-dengan-go-modules.html">
            
                <a href="A-setup-go-project-dengan-go-modules.html">
            
                    
                    A.3. Setup Go Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="A-gopath-dan-workspace.html">
            
                <a href="A-gopath-dan-workspace.html">
            
                    
                    A.4. Setup GOPATH Dan Workspace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="A-instalasi-editor.html">
            
                <a href="A-instalasi-editor.html">
            
                    
                    A.5. Instalasi Editor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="A-go-command.html">
            
                <a href="A-go-command.html">
            
                    
                    A.6. Go Command
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="A-hello-world.html">
            
                <a href="A-hello-world.html">
            
                    
                    A.7. Program Pertama: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="A-komentar.html">
            
                <a href="A-komentar.html">
            
                    
                    A.8. Komentar
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9" data-path="A-variabel.html">
            
                <a href="A-variabel.html">
            
                    
                    A.9. Variabel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.10" data-path="A-tipe-data.html">
            
                <a href="A-tipe-data.html">
            
                    
                    A.10. Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.11" data-path="A-konstanta.html">
            
                <a href="A-konstanta.html">
            
                    
                    A.11. Konstanta
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.12" data-path="A-operator.html">
            
                <a href="A-operator.html">
            
                    
                    A.12. Operator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.13" data-path="A-seleksi-kondisi.html">
            
                <a href="A-seleksi-kondisi.html">
            
                    
                    A.13. Seleksi Kondisi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.14" data-path="A-perulangan.html">
            
                <a href="A-perulangan.html">
            
                    
                    A.14. Perulangan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.15" data-path="A-array.html">
            
                <a href="A-array.html">
            
                    
                    A.15. Array
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.16" data-path="A-slice.html">
            
                <a href="A-slice.html">
            
                    
                    A.16. Slice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.17" data-path="A-map.html">
            
                <a href="A-map.html">
            
                    
                    A.17. Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.18" data-path="A-fungsi.html">
            
                <a href="A-fungsi.html">
            
                    
                    A.18. Fungsi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.19" data-path="A-fungsi-multiple-return.html">
            
                <a href="A-fungsi-multiple-return.html">
            
                    
                    A.19. Fungsi Multiple Return
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.20" data-path="A-fungsi-variadic.html">
            
                <a href="A-fungsi-variadic.html">
            
                    
                    A.20. Fungsi Variadic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.21" data-path="A-fungsi-closure.html">
            
                <a href="A-fungsi-closure.html">
            
                    
                    A.21. Fungsi Closure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.22" data-path="A-fungsi-sebagai-parameter.html">
            
                <a href="A-fungsi-sebagai-parameter.html">
            
                    
                    A.22. Fungsi Sebagai parameter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.23" data-path="A-pointer.html">
            
                <a href="A-pointer.html">
            
                    
                    A.23. Pointer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.24" data-path="A-struct.html">
            
                <a href="A-struct.html">
            
                    
                    A.24. Struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.25" data-path="A-method.html">
            
                <a href="A-method.html">
            
                    
                    A.25. Method
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.26" data-path="A-properti-public-dan-private.html">
            
                <a href="A-properti-public-dan-private.html">
            
                    
                    A.26. Properti Public dan Private (Exported vs Unexported)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.27" data-path="A-interface.html">
            
                <a href="A-interface.html">
            
                    
                    A.27. Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.28" data-path="A-interface-kosong.html">
            
                <a href="A-interface-kosong.html">
            
                    
                    A.28. Interface Kosong
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.29" data-path="A-reflect.html">
            
                <a href="A-reflect.html">
            
                    
                    A.29. Reflect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.30" data-path="A-goroutine.html">
            
                <a href="A-goroutine.html">
            
                    
                    A.30. Goroutine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.31" data-path="A-channel.html">
            
                <a href="A-channel.html">
            
                    
                    A.31. Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.32" data-path="A-buffered-channel.html">
            
                <a href="A-buffered-channel.html">
            
                    
                    A.32. Buffered Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.33" data-path="A-channel-select.html">
            
                <a href="A-channel-select.html">
            
                    
                    A.33. Channel - Select
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.34" data-path="A-channel-range-close.html">
            
                <a href="A-channel-range-close.html">
            
                    
                    A.34. Channel - Range & Close
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.35" data-path="A-channel-timeout.html">
            
                <a href="A-channel-timeout.html">
            
                    
                    A.35. Channel - Timeout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.36" data-path="A-defer-exit.html">
            
                <a href="A-defer-exit.html">
            
                    
                    A.36. Defer & Exit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.37" data-path="A-error-panic-recover.html">
            
                <a href="A-error-panic-recover.html">
            
                    
                    A.37. Error, Panic, & Recover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.38" data-path="A-string-format.html">
            
                <a href="A-string-format.html">
            
                    
                    A.38. Layout Format String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.39" data-path="A-random.html">
            
                <a href="A-random.html">
            
                    
                    A.39. Random
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.40" data-path="A-time-parsing-format.html">
            
                <a href="A-time-parsing-format.html">
            
                    
                    A.40. Time, Parsing Time, & Format Time
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.41" data-path="A-timer-ticker-scheduler.html">
            
                <a href="A-timer-ticker-scheduler.html">
            
                    
                    A.41. Timer, Ticker, & Scheduler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.42" data-path="A-time-duration.html">
            
                <a href="A-time-duration.html">
            
                    
                    A.42. Time Duration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.43" data-path="A-data-type-conversion.html">
            
                <a href="A-data-type-conversion.html">
            
                    
                    A.43. Konversi Antar Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.44" data-path="A-strings.html">
            
                <a href="A-strings.html">
            
                    
                    A.44. Fungsi String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.45" data-path="A-regex.html">
            
                <a href="A-regex.html">
            
                    
                    A.45. Regex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.46" data-path="A-encoding-base64.html">
            
                <a href="A-encoding-base64.html">
            
                    
                    A.46. Encode - Decode Base64
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.47" data-path="A-hash-sha1.html">
            
                <a href="A-hash-sha1.html">
            
                    
                    A.47. Hash Sha1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.48" data-path="A-command-line-args-flag.html">
            
                <a href="A-command-line-args-flag.html">
            
                    
                    A.48. Arguments & Flag
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.49" data-path="A-exec.html">
            
                <a href="A-exec.html">
            
                    
                    A.49. Exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.50" data-path="A-file.html">
            
                <a href="A-file.html">
            
                    
                    A.50. File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.51" data-path="A-web-server.html">
            
                <a href="A-web-server.html">
            
                    
                    A.51. Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.52" data-path="A-url-parsing.html">
            
                <a href="A-url-parsing.html">
            
                    
                    A.52. URL Parsing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.53" data-path="A-json.html">
            
                <a href="A-json.html">
            
                    
                    A.53. JSON Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.54" data-path="A-web-service-api.html">
            
                <a href="A-web-service-api.html">
            
                    
                    A.54. Web Service API Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.55" data-path="A-client-http-request-simple.html">
            
                <a href="A-client-http-request-simple.html">
            
                    
                    A.55. Simple Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.56" data-path="A-sql.html">
            
                <a href="A-sql.html">
            
                    
                    A.56. SQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.57" data-path="A-mongodb.html">
            
                <a href="A-mongodb.html">
            
                    
                    A.57. NoSQL MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.58" data-path="A-unit-test.html">
            
                <a href="A-unit-test.html">
            
                    
                    A.58. Unit Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.59" data-path="A-waitgroup.html">
            
                <a href="A-waitgroup.html">
            
                    
                    A.59. sync.WaitGroup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.60" data-path="A-mutex.html">
            
                <a href="A-mutex.html">
            
                    
                    A.60. sync.Mutex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.61" data-path="A-go-vendoring.html">
            
                <a href="A-go-vendoring.html">
            
                    
                    A.61. Go Vendoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.62" data-path="A-concurrency-pipeline.html">
            
                <a href="A-concurrency-pipeline.html">
            
                    
                    A.62. Concurrency Pattern: Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.63" data-path="A-simplified-fan-in-fan-out-pipeline.html">
            
                <a href="A-simplified-fan-in-fan-out-pipeline.html">
            
                    
                    A.63. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.1.64" data-path="A-pipeline-context-cancellation.html">
            
                <a href="A-pipeline-context-cancellation.html">
            
                    
                    A.64. Concurrency Pattern: Context Cancellation Pipeline
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1" >
            
                <span>
            
                    
                    B. Pemrograman Web Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="B-1-golang-web-hello-world.html">
            
                <a href="B-1-golang-web-hello-world.html">
            
                    
                    B.1. Golang Web App: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="B-2-routing-http-handlefunc.html">
            
                <a href="B-2-routing-http-handlefunc.html">
            
                    
                    B.2. Routing http.HandleFunc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="B-3-routing-static-assets.html">
            
                <a href="B-3-routing-static-assets.html">
            
                    
                    B.3. Routing Static Assets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="B-4-template-render-html.html">
            
                <a href="B-4-template-render-html.html">
            
                    
                    B.4. Template: Render HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="B-5-template-render-partial-html.html">
            
                <a href="B-5-template-render-partial-html.html">
            
                    
                    B.5. Template: Render Partial HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="B-6-template-actions-variables.html">
            
                <a href="B-6-template-actions-variables.html">
            
                    
                    B.6. Template: Actions & Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="B-7-template-functions.html">
            
                <a href="B-7-template-functions.html">
            
                    
                    B.7. Template: Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8" data-path="B-8-template-custom-functions.html">
            
                <a href="B-8-template-custom-functions.html">
            
                    
                    B.8. Template: Custom Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.9" data-path="B-9-render-specific-html-template.html">
            
                <a href="B-9-render-specific-html-template.html">
            
                    
                    B.9. Template: Render Specific HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.10" data-path="B-10-render-html-string.html">
            
                <a href="B-10-render-html-string.html">
            
                    
                    B.10. Template: Render HTML String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.11" data-path="B-11-http-method.html">
            
                <a href="B-11-http-method.html">
            
                    
                    B.11. HTTP Method: POST & GET
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.12" data-path="B-12-form-value.html">
            
                <a href="B-12-form-value.html">
            
                    
                    B.12. Form Value
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.13" data-path="B-13-form-upload-file.html">
            
                <a href="B-13-form-upload-file.html">
            
                    
                    B.13. Form Upload File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.14" data-path="B-14-ajax-json-payload.html">
            
                <a href="B-14-ajax-json-payload.html">
            
                    
                    B.14. AJAX JSON Payload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.15" data-path="B-15-ajax-json-response.html">
            
                <a href="B-15-ajax-json-response.html">
            
                    
                    B.15. AJAX JSON Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.16" data-path="B-16-ajax-multi-upload.html">
            
                <a href="B-16-ajax-multi-upload.html">
            
                    
                    B.16. AJAX Multiple File Upload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.17" data-path="B-17-download-file.html">
            
                <a href="B-17-download-file.html">
            
                    
                    B.17. Download File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.18" data-path="B-18-http-basic-auth.html">
            
                <a href="B-18-http-basic-auth.html">
            
                    
                    B.18. HTTP Basic Auth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.19" data-path="B-19-middleware-using-http-handler.html">
            
                <a href="B-19-middleware-using-http-handler.html">
            
                    
                    B.19. Middleware http.Handler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.20" data-path="B-20-custom-mux-multiplexer.html">
            
                <a href="B-20-custom-mux-multiplexer.html">
            
                    
                    B.20. Custom Multiplexer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.21" data-path="B-21-cookie.html">
            
                <a href="B-21-cookie.html">
            
                    
                    B.21. HTTP Cookie
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.22" data-path="B-22-simple-configuration.html">
            
                <a href="B-22-simple-configuration.html">
            
                    
                    B.22. Simple Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.23" data-path="B-server-handler-http-request-cancellation.html">
            
                <a href="B-server-handler-http-request-cancellation.html">
            
                    
                    B.23. Server Handler HTTP Request Cancellation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" >
            
                <span>
            
                    
                    C. Pemrograman Go Lanjut
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="C-1-echo-routing.html">
            
                <a href="C-1-echo-routing.html">
            
                    
                    C.1. Echo Framework & Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="C-2-parsing-http-request-payload-echo.html">
            
                <a href="C-2-parsing-http-request-payload-echo.html">
            
                    
                    C.2. Parsing HTTP Request Payload (Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="C-3-http-request-payload-validation.html">
            
                <a href="C-3-http-request-payload-validation.html">
            
                    
                    C.3. HTTP Request Payload Validation (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="C-4-http-error-handling.html">
            
                <a href="C-4-http-error-handling.html">
            
                    
                    C.4. HTTP Error Handling (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.5" data-path="C-5-echo-template-rendering.html">
            
                <a href="C-5-echo-template-rendering.html">
            
                    
                    C.5. Template Rendering in Echo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6" data-path="C-6-advanced-middleware-and-logging.html">
            
                <a href="C-6-advanced-middleware-and-logging.html">
            
                    
                    C.6. Advanced Middleware & Logging (Logrus, Echo Logger)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7" data-path="C-7-flag-parser.html">
            
                <a href="C-7-flag-parser.html">
            
                    
                    C.7. CLI Flag Parser (Kingpin)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8" >
            
                <span>
            
                    
                    C.8. Advanced Configuration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.8.1" data-path="C-8-A-advanced-configuration-viper.html">
            
                <a href="C-8-A-advanced-configuration-viper.html">
            
                    
                    C.8.A. Advanced Configuration: Viper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8.2" data-path="C-8-B-best-practice-configuration-env-var.html">
            
                <a href="C-8-B-best-practice-configuration-env-var.html">
            
                    
                    C.8.B. Best Practice Configuration: Environment Variable
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.1.9" data-path="C-9-securecookie.html">
            
                <a href="C-9-securecookie.html">
            
                    
                    C.9. Secure Cookie (Gorilla Securecookie)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.10" data-path="C-10-session.html">
            
                <a href="C-10-session.html">
            
                    
                    C.10. Session (Gorilla Session)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11" data-path="C-12-cors-preflight-request.html">
            
                <a href="C-12-cors-preflight-request.html">
            
                    
                    C.12. CORS & Preflight Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12" data-path="C-13-csrf.html">
            
                <a href="C-13-csrf.html">
            
                    
                    C.13. CSRF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.13" data-path="C-14-secure-middleware.html">
            
                <a href="C-14-secure-middleware.html">
            
                    
                    C.14. Secure Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14" data-path="C-15-http-gzip-compression.html">
            
                <a href="C-15-http-gzip-compression.html">
            
                    
                    C.15. HTTP Gzip Compression (gziphandler)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.15" data-path="C-16-send-email.html">
            
                <a href="C-16-send-email.html">
            
                    
                    C.16. Send Mail (net/smtp, Gomail v2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.16" data-path="C-17-read-write-excel-xlsx-file.html">
            
                <a href="C-17-read-write-excel-xlsx-file.html">
            
                    
                    C.17. Read & Write Excel XLSX File (Excelize)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.17" data-path="C-18-write-pdf-file.html">
            
                <a href="C-18-write-pdf-file.html">
            
                    
                    C.18. Write PDF File (gofpdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18" data-path="C-19-convert-html-to-pdf.html">
            
                <a href="C-19-convert-html-to-pdf.html">
            
                    
                    C.19. Convert HTML to PDF (go-wkhtmltopdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19" data-path="C-20-scraping-parsing-html.html">
            
                <a href="C-20-scraping-parsing-html.html">
            
                    
                    C.20. Scraping & Parsing HTML (goquery)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.20" data-path="C-21-xml-parser.html">
            
                <a href="C-21-xml-parser.html">
            
                    
                    C.21. Parse & Generate XML (etree)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.21" data-path="C-22-https-tls.html">
            
                <a href="C-22-https-tls.html">
            
                    
                    C.22. HTTPS/TLS Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.22" data-path="C-23-http2-server-push.html">
            
                <a href="C-23-http2-server-push.html">
            
                    
                    C.23. HTTP/2 & HTTP/2 Server Push
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.23" data-path="C-24-client-http-request-advanced.html">
            
                <a href="C-24-client-http-request-advanced.html">
            
                    
                    C.24. Advanced Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.24" data-path="C-25-secure-insecure-client-http-request.html">
            
                <a href="C-25-secure-insecure-client-http-request.html">
            
                    
                    C.25. Secure & Insecure Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.25" data-path="C-26-golang-ftp.html">
            
                <a href="C-26-golang-ftp.html">
            
                    
                    C.26. FTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.26" data-path="C-27-golang-ssh-sftp.html">
            
                <a href="C-27-golang-ssh-sftp.html">
            
                    
                    C.27. SSH & SFTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.27" data-path="C-29-golang-protobuf-implementation.html">
            
                <a href="C-29-golang-protobuf-implementation.html">
            
                    
                    C.29. Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.28" data-path="C-30-golang-grpc-protobuf.html">
            
                <a href="C-30-golang-grpc-protobuf.html">
            
                    
                    C.30. gRPC + Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.29" data-path="C-32-golang-jwt.html">
            
                <a href="C-32-golang-jwt.html">
            
                    
                    C.32. JSON Web Token (JWT)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.30" data-path="C-33-golang-ldap-authentication.html">
            
                <a href="C-33-golang-ldap-authentication.html">
            
                    
                    C.33. LDAP Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.31" data-path="C-34-golang-sso-saml-sp.html">
            
                <a href="C-34-golang-sso-saml-sp.html">
            
                    
                    C.34. SSO SAML (Service Provider)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.32" data-path="C-dockerize-golang.html">
            
                <a href="C-dockerize-golang.html">
            
                    
                    C.35. Dockerize Aplikasi Golang
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <span>
            
                    
                    D. Studi Kasus
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="D-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                <a href="D-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                    
                    D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="D-google-api-search.html">
            
                <a href="D-google-api-search.html">
            
                    
                    D.2. Google API Search Dengan Timeout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="D-golang-web-socket-chatting-app.html">
            
                <a href="D-golang-web-socket-chatting-app.html">
            
                    
                    D.3. Web Socket: Chatting App
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >A.64. Concurrency Pattern: Context Cancellation Pipeline</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="a64-concurrency-pattern-context-cancellation-pipeline">A.64. Concurrency Pattern: Context Cancellation Pipeline</h1>
<p>Pada bab ini kita akan belajar tentang salah satu <em>concurrency pattern</em> di Go, yaitu <strong>cancellation</strong>. Cancellation merupakan mekanisme untuk menggagalkan secara paksa proses konkuren yang sedang berjalan, entah itu karena ada timeout, ada error, atau ada faktor lain.</p>
<p>Disini kita akan gunakan salah satu API milik Go yang tersedia untuk <em>cancellation</em>, yaitu <code>context.Context</code>.</p>
<p>Context digunakan untuk mendefinisikan tipe <em>context</em> yang didalamnya ada beberapa hal yaitu: informasi <em>deadlines</em>, signal <em>cancellation</em>, dan data untuk keperluan komunikasi antar API atau antar proses.</p>
<h2 id="a641-skenario-praktek">A.64.1. Skenario Praktek</h2>
<p>Kita akan modifikasi file program <a href="A-simplified-fan-in-fan-out-pipeline.html"><code>1-generate-dummy-files-concurrently.go</code> yang pada chapter sebelumnya sudah dibuat</a>. Pada program tersebut akan kita tambahkan mekanisme cancellation ketika ada timeout.</p>
<p>Jadi kurang lebih akan ada dua result:</p>
<ul>
<li>Proses sukses, karena <em>execution time</em> dibawah timeout.</li>
<li>Proses digagalkan secara paksa ditengah jalan, karena <em>running time</em> sudah melebihi batas timeout.</li>
</ul>
<h2 id="a642-program-generate-dummy-file-concurrently">A.64.2. Program Generate Dummy File <em>Concurrently</em></h2>
<p>Ok langsung saja, pertama yang perlu dipersiapkan adalah tulis dulu kode program versi <em>concurrent</em> tanpa <em>cancellation</em>. Bisa langsung copy-paste, atau tulis dari awal dengan mengikut tutorial ini secara keseluruhan. Untuk penjelasan detail program versi sekuensial silakan merujuk ke chapter sebelumnya saja, disini kita tulis langsung agar bisa cepat dimulai bagian program konkuren.</p>
<h4 id="import-packages-dan-definisi-variabel">&#x2022; Import Packages dan Definisi Variabel</h4>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;fmt&quot;</span>
    <span class="hljs-string">&quot;io/ioutil&quot;</span>
    <span class="hljs-string">&quot;log&quot;</span>
    <span class="hljs-string">&quot;math/rand&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;path/filepath&quot;</span>
    <span class="hljs-string">&quot;sync&quot;</span>
    <span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">const</span> totalFile = <span class="hljs-number">3000</span>
<span class="hljs-keyword">const</span> contentLength = <span class="hljs-number">5000</span>

<span class="hljs-keyword">var</span> tempPath = filepath.Join(os.Getenv(<span class="hljs-string">&quot;TEMP&quot;</span>), <span class="hljs-string">&quot;chapter-A.61-pipeline-cancellation-context&quot;</span>)
</code></pre>
<h4 id="definisi-struct-fileinfo">&#x2022; Definisi struct <code>FileInfo</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> FileInfo <span class="hljs-keyword">struct</span> {
    Index       <span class="hljs-keyword">int</span>
    FileName    <span class="hljs-keyword">string</span>
    WorkerIndex <span class="hljs-keyword">int</span>
    Err         error
}
</code></pre>
<h4 id="fungsi-init-dan-main">&#x2022; Fungsi <code>init()</code> dan <code>main()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> init() {
    rand.Seed(time.Now().UnixNano())
}

<span class="hljs-keyword">func</span> main() {
    log.Println(<span class="hljs-string">&quot;start&quot;</span>)
    start := time.Now()

    generateFiles()

    duration := time.Since(start)
    log.Println(<span class="hljs-string">&quot;done in&quot;</span>, duration.Seconds(), <span class="hljs-string">&quot;seconds&quot;</span>)
}
</code></pre>
<h4 id="fungsi-randomstring">&#x2022; Fungsi <code>randomString()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> randomString(length <span class="hljs-keyword">int</span>) <span class="hljs-keyword">string</span> {
    letters := []<span class="hljs-keyword">rune</span>(<span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>)

    b := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">rune</span>, length)
    <span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> b {
        b[i] = letters[rand.Intn(<span class="hljs-built_in">len</span>(letters))]
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>(b)
}
</code></pre>
<h4 id="fungsi-generatefiles">&#x2022; Fungsi <code>generateFiles()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> generateFiles() {
    os.RemoveAll(tempPath)
    os.MkdirAll(tempPath, os.ModePerm)

    <span class="hljs-comment">// pipeline 1: job distribution</span>
    chanFileIndex := generateFileIndexes()

    <span class="hljs-comment">// pipeline 2: the main logic (creating files)</span>
    createFilesWorker := <span class="hljs-number">100</span>
    chanFileResult := createFiles(chanFileIndex, createFilesWorker)

    <span class="hljs-comment">// track and print output</span>
    counterTotal := <span class="hljs-number">0</span>
    counterSuccess := <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> fileResult := <span class="hljs-keyword">range</span> chanFileResult {
        <span class="hljs-keyword">if</span> fileResult.Err != <span class="hljs-literal">nil</span> {
            log.Printf(<span class="hljs-string">&quot;error creating file %s. stack trace: %s&quot;</span>, fileResult.FileName, fileResult.Err)
        } <span class="hljs-keyword">else</span> {
            counterSuccess++
        }
        counterTotal++
    }

    log.Printf(<span class="hljs-string">&quot;%d/%d of total files created&quot;</span>, counterSuccess, counterTotal)
}
</code></pre>
<h4 id="fungsi-generatefileindexes">&#x2022; Fungsi <code>generateFileIndexes()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> generateFileIndexes() &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; totalFile; i++ {
            chanOut &lt;- FileInfo{
                Index:    i,
                FileName: fmt.Sprintf(<span class="hljs-string">&quot;file-%d.txt&quot;</span>, i),
            }
        }
        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<h4 id="fungsi-createfiles">&#x2022; Fungsi <code>createFiles()</code></h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> createFiles(chanIn &lt;-<span class="hljs-keyword">chan</span> FileInfo, numberOfWorkers <span class="hljs-keyword">int</span>) &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    wg := <span class="hljs-built_in">new</span>(sync.WaitGroup)
    wg.Add(numberOfWorkers)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">for</span> workerIndex := <span class="hljs-number">0</span>; workerIndex &lt; numberOfWorkers; workerIndex++ {
            <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>(workerIndex <span class="hljs-keyword">int</span>) {
                <span class="hljs-keyword">for</span> job := <span class="hljs-keyword">range</span> chanIn {
                    filePath := filepath.Join(tempPath, job.FileName)
                    content := randomString(contentLength)
                    err := ioutil.WriteFile(filePath, []<span class="hljs-keyword">byte</span>(content), os.ModePerm)

                    log.Println(<span class="hljs-string">&quot;worker&quot;</span>, workerIndex, <span class="hljs-string">&quot;working on&quot;</span>, job.FileName, <span class="hljs-string">&quot;file generation&quot;</span>)

                    chanOut &lt;- FileInfo{
                        FileName:    job.FileName,
                        WorkerIndex: workerIndex,
                        Err:         err,
                    }
                }

                wg.Done()
            }(workerIndex)
        }
    }()

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        wg.Wait()
        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<p>Hasil eksekusi program:</p>
<p><img src="images/A_pipeline_context_cancellation_1_concurrent_without_cancellation.png" alt="Dasar Pemrograman Golang - Concurrent without cancellation"></p>
<h2 id="a643-program-generate-dummy-file-concurrently-dan-mekanisme-cancellation">A.64.3. Program Generate Dummy File <em>Concurrently</em> dan Mekanisme <em>Cancellation</em></h2>
<p>Ok, sekarang kita akan refactor kode tersebut, kita tambahkan mekanisme <em>cancellation</em> menggunakan <code>context.Context</code> API. Silakan duplikasi file program, lalu ikuti petunjuk berikut.</p>
<h4 id="import-package-context">&#x2022; Import package <code>context</code></h4>
<p>Tambahkan package <code>context</code> dalam block import packages.</p>
<pre><code class="lang-go"><span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;context&quot;</span>

    <span class="hljs-comment">// ...</span>
)
</code></pre>
<h4 id="tambahkan-definisi-konstanta-timeout">&#x2022; Tambahkan definisi konstanta timeout</h4>
<p>Disini saya tentukan timeout adalah 3 menit. Nantinya kita akan modifikasi angka timeout untuk keperluan testing.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> timeoutDuration = <span class="hljs-number">3</span> * time.Second
</code></pre>
<h4 id="penerapan-context-di-fungsi-main">&#x2022; Penerapan context di fungsi <code>main()</code></h4>
<p>Pada fungsi main, lakukan sedikit perubahan. Yang sebelumnya ada statement berikut:</p>
<pre><code class="lang-go">generateFiles()
</code></pre>
<p>Ubah menjadi berikut:</p>
<pre><code class="lang-go">ctx, cancel := context.WithTimeout(context.Background(), timeoutDuration)
<span class="hljs-keyword">defer</span> cancel()
generateFilesWithContext(ctx)
</code></pre>
<p>Fungsi <code>generateFilesWithContext()</code> merupakan fungsi yang sama persis dengan <code>generateFiles()</code> (yang tentunya akan kita buat). Perbedaannya adalah hanya pada fungsi baru ini ada satu argument baru yaitu data <code>context.Context</code>.</p>
<p>Ini merupakan salah satu idiomatic Go untuk cara penulisan fungsi yang <em>cancellable</em>. Umumnya akan ada fungsi tanpa context dan fungsi yang ada context-nya. Contohnya seperti berikut:</p>
<pre><code class="lang-go">generateFiles()
generateFilesWithContext(ctx)
</code></pre>
<p>Dimisalkan lagi jika argument context adalah wajib pada sebuah fungsi, maka cukup gunakan 1 fungsi saja, yang ada <code>WithContext()</code>-nya dihapus, tapi satu fungsi yang ada ditambahkan context. Contohnya:</p>
<pre><code class="lang-go">generateFiles(ctx)
</code></pre>
<p>Pada contoh ini kita akan siapkan dua fungsi, yang ada context-nya dan yang tidak.</p>
<p>Ok lanjut ke pembahasan. Fungsi <code>context.WithTimeout</code> digunakan untuk menambahkan timeout pada sebuah context. Parameter pertama fungsi ini adalah objek context juga. Pada contoh di atas, karena sebelumnya belum ada objek context, maka kita buat objek context baru lewat <code>context.Background()</code>.</p>
<p>Cara pembuatan object context sendiri sebenarnya ada 3:</p>
<ol>
<li>Menggunakan fungsi <code>context.Background()</code>. Fungsi tersebut menghasilkan objek context yang data di dalamnya adalah kosong dan tidak memiliki deadline. Context ini biasanya digunakan untuk inisialisasi object context baru yang nanti akan di-chain dengan fungsi <code>context.With...</code>.</li>
<li>Menggunakan fungsi <code>context.TODO()</code>. Fungsi ini menghasilkan objek context baru seperti <code>context.Background()</code>. Context buatan fungsi TODO ini biasanya digunakan dalam situasi ketika belum jelas nantinya harus menggunakan jenis context apa (apakah dengan timeout, apakah dengan cancel).</li>
<li><p>Menggunakan fungsi <code>context.With...</code>. Fungsi ini sebenarnya bukan digunakan untuk inisialisasi objek konteks baru, tapi digunakan untuk menambahkan informasi tertentu pada <em>copied</em> context yang disisipkan di parameter pertama pemanggilan fungsi. Ada 3 buah fungsi <code>context.With...</code> yang bisa digunakan, yaitu:</p>
<ul>
<li>Fungsi <code>context.WithCancel(ctx) (ctx, cancel)</code>. Fungsi ini digunakan untuk menambahkan fasilitas <em>cancellable</em> pada context yang disisipkan sebagai parameter pertama pemanggilan fungsi. Lewat nilai balik kedua, yaitu <code>cancel</code> yang tipenya <code>context.CancelFunc</code>, kita bisa secara paksa meng-<em>cancel</em> context ini.</li>
<li>Fungsi <code>context.WithDeadline(ctx, time.Time) (ctx, cancel)</code>. Fungsi ini juga menambahkan fitur <em>cancellable</em> pada context, tapi selain itu juga menambahkan informasi deadline yang dimana jika waktu sekarang sudah melebihi deadline yang sudah ditentukan maka context otomatis di-cancel secara paksa.</li>
<li>Fungsi <code>context.WithTimeout(ctx, time.Duration) (ctx, cancel)</code>. Fungsi ini sama seperti <code>context.WithDeadline()</code>, bedanya pada parameter kedua argument bertipe durasi (bukan objek <code>time.Time</code>).</li>
</ul>
</li>
</ol>
<p>Kesamaan dari ketiga fungsi <code>context.With...</code> adalah sama-sama menambahkan fasilitas <em>cancellable</em> yang bisa dieksekusi lewat nilai balik kedua fungsi tersebut (yang tipenya <code>context.CancelFunc</code>).</p>
<p>Jadi pada contoh yang kita tulis di atas, kurang lebih yang akan dilakukan adalah:</p>
<ul>
<li>Kira buat object context baru lewat <code>context.Background()</code>.</li>
<li>Objek context tersebut ditambahkan fasilitas <em>cancellable</em> didalamnya, dan juga auto cancel ketika timeout menggunakan <code>context.WithTimeout()</code>, dengan durasi timeout adalah <code>timeoutDuration</code>.</li>
<li>Fungsi <code>generateFilesWithContext()</code> dipanggil dengan disisipkan object context.</li>
<li>Callback <code>context.CancelFunc</code> dipanggil secara deferred. Ini merupakan idiomatic Go dalam penerapan context. Meskipun context sudah punya timeout atau deadline dan kita tidak perlu meng-<em>cancel</em> context secara manual, sangat dianjurkan untuk tetap memanggil callback <code>cancel()</code> tersebut secara deferred.</li>
</ul>
<h4 id="modifikasi-fungsi-generatefiles">&#x2022; Modifikasi fungsi <code>generateFiles()</code></h4>
<p>Isi dari fungsi <code>generateFiles()</code> kita ubah menjadi pemanggilan fungsi <code>generateFilesWithContext()</code> dengan parameter context kosong.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> generateFiles() {
    generateFilesWithContext(context.Background())
}
</code></pre>
<p>Pada fungsi <code>generateFilesWithContext()</code> sendiri, isinya adalah isi <code>generateFiles()</code> sebelumnya tapi ditambahkan beberapa hal. Silakan tulis dulu kode berikut.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> generateFilesWithContext(ctx context.Context) {
    os.RemoveAll(tempPath)
    os.MkdirAll(tempPath, os.ModePerm)

    done := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-comment">// pipeline 1: job distribution</span>
        chanFileIndex := generateFileIndexes(ctx)

        <span class="hljs-comment">// pipeline 2: the main logic (creating files)</span>
        createFilesWorker := <span class="hljs-number">100</span>
        chanFileResult := createFiles(ctx, chanFileIndex, createFilesWorker)

        <span class="hljs-comment">// track and print output</span>
        counterSuccess := <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> fileResult := <span class="hljs-keyword">range</span> chanFileResult {
            <span class="hljs-keyword">if</span> fileResult.Err != <span class="hljs-literal">nil</span> {
                log.Printf(<span class="hljs-string">&quot;error creating file %s. stack trace: %s&quot;</span>, fileResult.FileName, fileResult.Err)
            } <span class="hljs-keyword">else</span> {
                counterSuccess++
            }
        }

        <span class="hljs-comment">// notify that the process is complete</span>
        done &lt;- counterSuccess
    }()

    <span class="hljs-keyword">select</span> {
    <span class="hljs-keyword">case</span> &lt;-ctx.Done():
        log.Printf(<span class="hljs-string">&quot;generation process stopped. %s&quot;</span>, ctx.Err())
    <span class="hljs-keyword">case</span> counterSuccess := &lt;-done:
        log.Printf(<span class="hljs-string">&quot;%d/%d of total files created&quot;</span>, counterSuccess, totalFile)
    }
}
</code></pre>
<p>Penambahan yang dimaksud adalah, statement pipelines dibungus dengan sebuah goroutine IIFE, yang di akhir fungsi kita kirim informasi jumlah file yang berhasil di-generate (<code>counterSuccess</code>) ke sebuah channel bernama <code>done</code>.</p>
<p>Channel <code>done</code> ini kita gunakan sebagai indikator bahwa proses pipeline sudah selesai secara keseluruhan.</p>
<p>Selain goroutine, di akhir fungsi <code>generateFilesWithContext()</code> sendiri ditambahkan <em>channel selection</em> dengan isi dua buah cases.</p>
<p>Case pertama adalah ketika channel done pada context <code>ctx</code> menerima data. Cara penggunaannya seperti ini <code>&lt;-ctx.Done()</code>. Ketika channel done milik context ini menerima data, berarti context telah di-cancel secara paksa. Cancel-nya bisa karena memang context melebihi timeout yang sudah ditentukan, atau di-cancel secara eksplisit lewat pemanggilan callback <code>context.CancelFunc</code>. Untuk mengetahui alasan cancel bisa dengan cara mengakses method error milik contex, yaitu: <code>ctx.Err()</code>.</p>
<p>Jadi pada contoh di atas, ketika context timeout atau di-cancel secara eksplisit (via callback <code>cancel</code>), maka case pertama akan terpenuhi dan message ditampilkan.</p>
<p>Untuk case kedua akan terpenuhi ketika proses pipeline sudah selesai secara keseluruhan. Bisa dilihat di akhir goroutine, disitu channel <code>done</code> dikirimi informasi <code>counterSuccess</code>. Ketika ini terjadi maka kondisi case kedua terpenuhi, lalu ditampilkan informasi file yang sudah sukses dibuat.</p>
<p>Nah jadi lewat seleksi kondisi 2 case di atas, kita bisa dengan mudah mengidentifikasi apakah proses selesai sepenuhnya, ataukah cancelled ditengah jalan karena timeout ataupun karena di-cancel secara eksplisit.</p>
<p>Selain beberapa hal yang sudah saya sampaikan, ada <em>minor changes</em> lainnya, yaitu pada pemanggilan fungsi <code>generateFileIndexes()</code> dan <code>createFiles()</code> ditambahkan argument context.</p>
<h4 id="penambahan-context-pada-fungsi-generatefiles">&#x2022; Penambahan context pada fungsi <code>generateFiles()</code></h4>
<p>Kenapa ini perlu? karena <strong>meski eksekusi fungsi <code>generateFilesWithContext()</code> otomatis di stop ketika cancelled, proses di dalamnya akan tetap berjalan jika tidak di-<em>handle</em> dengan baik <em>cancellation</em>-nya.</strong></p>
<p>Maka dari itu kita perlu memodifikasi, memastikan bahwa cancellation juga diberlakukan dalam level sub proses.</p>
<p>Silakan tulis kode berikut pada fungsi <code>generateFileIndexes()</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> generateFileIndexes(ctx context.Context) &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; totalFile; i++ {
            <span class="hljs-keyword">select</span> {
            <span class="hljs-keyword">case</span> &lt;-ctx.Done():
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">default</span>:
                chanOut &lt;- FileInfo{
                    Index:    i,
                    FileName: fmt.Sprintf(<span class="hljs-string">&quot;file-%d.txt&quot;</span>, i),
                }
            }
        }
        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<p>Dibanding sebelumnya, perbedaannya adalah ada <em>channel selection</em>. Jadi di bagian pengiriman jobs, ketika sebelum semua jobs dikirim tapi ada notif untuk cancel maka kita akan skip pengiriman <em>remainin</em> jobs secara paksa.</p>
<ul>
<li>Jika ada notif cancel paksa, maka case pertama akan terpenuhi, dan perulangan di-<code>break</code>.</li>
<li>Selebihnya, pengiriman jobs akan berlangsung seperti normalnya.</li>
</ul>
<h4 id="penambahan-context-pada-fungsi-createfiles">&#x2022; Penambahan context pada fungsi <code>createFiles()</code></h4>
<p>Hal yang sama (cancel di level sub prosees) juga perlu diterapkan pada <code>createFiles()</code>, karena jika tidak, maka proses pembuatan file akan tetap berjalan sesuai dengan jumlah jobs yang dikirim meskipun sudah di-cancel secara paksa.</p>
<p>Sebenarnya penambahan cancellation pada fungsi <code>generateFiles()</code> sudah cukup, karena ketika cancelled maka sisa jobs tidak akan dikirim. Tapi pada contoh ini penulis ingin ketika cancelled, maka tidak hanya pengiriman jobs tapi eksekusi jobs juga di-stop secara paksa (meski mungkin masih ada sebagian jobs yang masih dalam antrian).</p>
<p>Silakan tulis kode berikut.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> createFiles(ctx context.Context, chanIn &lt;-<span class="hljs-keyword">chan</span> FileInfo, numberOfWorkers <span class="hljs-keyword">int</span>) &lt;-<span class="hljs-keyword">chan</span> FileInfo {
    chanOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> FileInfo)

    wg := <span class="hljs-built_in">new</span>(sync.WaitGroup)
    wg.Add(numberOfWorkers)

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        <span class="hljs-keyword">for</span> workerIndex := <span class="hljs-number">0</span>; workerIndex &lt; numberOfWorkers; workerIndex++ {
            <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>(workerIndex <span class="hljs-keyword">int</span>) {
                <span class="hljs-keyword">for</span> job := <span class="hljs-keyword">range</span> chanIn {
                    <span class="hljs-keyword">select</span> {
                    <span class="hljs-keyword">case</span> &lt;-ctx.Done():
                        <span class="hljs-keyword">break</span>
                    <span class="hljs-keyword">default</span>:
                        filePath := filepath.Join(tempPath, job.FileName)
                        content := randomString(contentLength)
                        err := ioutil.WriteFile(filePath, []<span class="hljs-keyword">byte</span>(content), os.ModePerm)

                        log.Println(<span class="hljs-string">&quot;worker&quot;</span>, workerIndex, <span class="hljs-string">&quot;working on&quot;</span>, job.FileName, <span class="hljs-string">&quot;file generation&quot;</span>)

                        chanOut &lt;- FileInfo{
                            FileName:    job.FileName,
                            WorkerIndex: workerIndex,
                            Err:         err,
                        }
                    }
                }

                wg.Done()
            }(workerIndex)
        }
    }()

    <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
        wg.Wait()
        <span class="hljs-built_in">close</span>(chanOut)
    }()

    <span class="hljs-keyword">return</span> chanOut
}
</code></pre>
<p>Penambahannya juga sama seperti fungsi-fungsi yang lain, yaitu dengan menambahkan <em>channel selection</em>. Ketika ada notifikasi cancel maka perulangan jobs di break. Selebihnya maka harus berjalan seperti normalnya.</p>
<h2 id="a644-test-eksekusi-program">A.64.4. Test Eksekusi Program</h2>
<p>Jalankan program ke-dua, lihat hasilnya. Karena sebelumnya kita sudah set durasi timeout adalah <strong>3 detik</strong>, maka jika proses belum selesai sebelum durasi tersebut akan di-cancel secara paksa.</p>
<p><img src="images/A_pipeline_context_cancellation_2_context_timeout.png" alt="Dasar Pemrograman Golang - Context timeout"></p>
<p>Cukup mudah bukan?</p>
<p>Silakan coba modifikasi durasinya dengan nilai lebih besar, misalnya <strong>15 detik</strong>, lalu coba jalankan.</p>
<p><img src="images/A_pipeline_context_cancellation_1_concurrent_without_cancellation.png" alt="Dasar Pemrograman Golang - Concurrent without cancellation"></p>
<p>Bisa dilihat, di gambar di atas, jika program selesai sebelum <strong>15 detik</strong> maka aman.</p>
<h2 id="a645-cancel-context-secara-paksa-tanpa-timeout">A.64.5. Cancel Context Secara Paksa (Tanpa Timeout)</h2>
<p>Coba lakukan modifikasi sedikit pada bagian pemanggilan generate files, dari:</p>
<pre><code class="lang-go">ctx, cancel := context.WithTimeout(context.Background(), timeoutDuration)
<span class="hljs-keyword">defer</span> cancel()
generateFilesWithContext(ctx)
</code></pre>
<p>Ke:</p>
<pre><code class="lang-go">ctx, cancel := context.WithCancel(context.Background())
<span class="hljs-keyword">defer</span> cancel()
time.AfterFunc(timeoutDuration, cancel)
generateFilesWithContext(ctx)
</code></pre>
<p>Lalu coba jalankan, maka hasilnya adalah tetap sama. Jika eksekusi program melebihi context maka akan di-cancel secara paksa, selebihnya aman.</p>
<p>Perbedannya ada pada penerapan <em>cancellation</em>-nya. Pada contoh ini kita tidak menggunakan timeout, melainkan menggunakan <em>explicit cancel</em> dengan mensimulasi timeout menggunakan <code>time.AfterFunc()</code>.</p>
<hr>
<div class="source-code-link">
    <div class="source-code-link-message">Source code praktek pada bab ini tersedia di Github</div>
    <a href="https://github.com/novalagung/dasarpemrogramangolang-example/tree/master/chapter-A.64-pipeline-context-cancellation" target="_blank">https://github.com/novalagung/dasarpemrogramangolang-example/.../chapter-A.64...</a>
</div>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="A-simplified-fan-in-fan-out-pipeline.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: A.63. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"A.64. Concurrency Pattern: Context Cancellation Pipeline","level":"3.1.64","depth":2,"next":{"title":"B. Pemrograman Web Go Dasar","level":"4.1","depth":1,"ref":"","articles":[{"title":"B.1. Golang Web App: Hello World","level":"4.1.1","depth":2,"path":"B-1-golang-web-hello-world.md","ref":"B-1-golang-web-hello-world.md","articles":[]},{"title":"B.2. Routing http.HandleFunc","level":"4.1.2","depth":2,"path":"B-2-routing-http-handlefunc.md","ref":"B-2-routing-http-handlefunc.md","articles":[]},{"title":"B.3. Routing Static Assets","level":"4.1.3","depth":2,"path":"B-3-routing-static-assets.md","ref":"B-3-routing-static-assets.md","articles":[]},{"title":"B.4. Template: Render HTML Template","level":"4.1.4","depth":2,"path":"B-4-template-render-html.md","ref":"B-4-template-render-html.md","articles":[]},{"title":"B.5. Template: Render Partial HTML Template","level":"4.1.5","depth":2,"path":"B-5-template-render-partial-html.md","ref":"B-5-template-render-partial-html.md","articles":[]},{"title":"B.6. Template: Actions & Variables","level":"4.1.6","depth":2,"path":"B-6-template-actions-variables.md","ref":"B-6-template-actions-variables.md","articles":[]},{"title":"B.7. Template: Functions","level":"4.1.7","depth":2,"path":"B-7-template-functions.md","ref":"B-7-template-functions.md","articles":[]},{"title":"B.8. Template: Custom Functions","level":"4.1.8","depth":2,"path":"B-8-template-custom-functions.md","ref":"B-8-template-custom-functions.md","articles":[]},{"title":"B.9. Template: Render Specific HTML Template","level":"4.1.9","depth":2,"path":"B-9-render-specific-html-template.md","ref":"B-9-render-specific-html-template.md","articles":[]},{"title":"B.10. Template: Render HTML String","level":"4.1.10","depth":2,"path":"B-10-render-html-string.md","ref":"B-10-render-html-string.md","articles":[]},{"title":"B.11. HTTP Method: POST & GET","level":"4.1.11","depth":2,"path":"B-11-http-method.md","ref":"B-11-http-method.md","articles":[]},{"title":"B.12. Form Value","level":"4.1.12","depth":2,"path":"B-12-form-value.md","ref":"B-12-form-value.md","articles":[]},{"title":"B.13. Form Upload File","level":"4.1.13","depth":2,"path":"B-13-form-upload-file.md","ref":"B-13-form-upload-file.md","articles":[]},{"title":"B.14. AJAX JSON Payload","level":"4.1.14","depth":2,"path":"B-14-ajax-json-payload.md","ref":"B-14-ajax-json-payload.md","articles":[]},{"title":"B.15. AJAX JSON Response","level":"4.1.15","depth":2,"path":"B-15-ajax-json-response.md","ref":"B-15-ajax-json-response.md","articles":[]},{"title":"B.16. AJAX Multiple File Upload","level":"4.1.16","depth":2,"path":"B-16-ajax-multi-upload.md","ref":"B-16-ajax-multi-upload.md","articles":[]},{"title":"B.17. Download File","level":"4.1.17","depth":2,"path":"B-17-download-file.md","ref":"B-17-download-file.md","articles":[]},{"title":"B.18. HTTP Basic Auth","level":"4.1.18","depth":2,"path":"B-18-http-basic-auth.md","ref":"B-18-http-basic-auth.md","articles":[]},{"title":"B.19. Middleware http.Handler","level":"4.1.19","depth":2,"path":"B-19-middleware-using-http-handler.md","ref":"B-19-middleware-using-http-handler.md","articles":[]},{"title":"B.20. Custom Multiplexer","level":"4.1.20","depth":2,"path":"B-20-custom-mux-multiplexer.md","ref":"B-20-custom-mux-multiplexer.md","articles":[]},{"title":"B.21. HTTP Cookie","level":"4.1.21","depth":2,"path":"B-21-cookie.md","ref":"B-21-cookie.md","articles":[]},{"title":"B.22. Simple Configuration","level":"4.1.22","depth":2,"path":"B-22-simple-configuration.md","ref":"B-22-simple-configuration.md","articles":[]},{"title":"B.23. Server Handler HTTP Request Cancellation","level":"4.1.23","depth":2,"path":"B-server-handler-http-request-cancellation.md","ref":"B-server-handler-http-request-cancellation.md","articles":[]}]},"previous":{"title":"A.63. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline","level":"3.1.63","depth":2,"path":"A-simplified-fan-in-fan-out-pipeline.md","ref":"A-simplified-fan-in-fan-out-pipeline.md","articles":[]},"dir":"ltr"},"config":{"plugins":["ga","disqus","meta","sitemap"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"dasarpemrogramangolang"},"meta":{"content":"","data":[{"name":"google-site-verification","content":"UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"},{"name":"og:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"},{"name":"twitter:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"}],"name":""},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sitemap":{"hostname":"https://dasarpemrogramangolang.novalagung.com/"},"ga":{"configuration":"auto","token":"UA-27602984-29"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","lunr":{"maxIndexSize":1000000000},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"A-pipeline-context-cancellation.md","mtime":"2020-11-05T08:28:15.182Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-11-05T08:29:01.020Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    <div style="position: fixed; top: 10px; right: 30px; padding: 10px; background-color: rgba(255, 255, 255, 0.7);"><a class="github-button" href="https://github.com/novalagung/dasarpemrogramangolang" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star novalagung/dasarpemrogramangolang on GitHub">Star</a>&nbsp;<a class="github-button" href="https://github.com/novalagung" data-size="large" aria-label="Follow @novalagung on GitHub">Follow @novalagung</a><script async defer src="https://buttons.github.io/buttons.js"></script></div></body>
</html>

