<!DOCTYPE HTML>
<html lang>
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Golang Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover - Dasar Pemrograman Golang</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content>
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-docsearch-v3/style.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-disqus/plugin.css" media="print" onload="this.media='all'">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css" media="print" onload="this.media='all'">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css" media="print" onload="this.media='all'">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="google-site-verification" content="UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE">
    
    <meta name="og:image" content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg">
    
    <meta name="twitter:image" content="https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg">
    
    
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="D-google-api-search.html">
    
    


    <link rel="stylesheet" href="gitbook/custom.css?v=3.2024.08.30.072036"><script async defer src="https://buttons.github.io/buttons.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-MZ74P74K72"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'G-MZ74P74K72');
		</script></head>
    <body>
        
<div class="book">
    <div class="book-summary"><div id="book-search-input"><div id="book-doc-search-input"></div></div>
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Dasar Pemrograman Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="CHANGELOG.html">
            
                <a href="CHANGELOG.html">
            
                    
                    Version Changelogs &amp; Updates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="download-ebook.html">
            
                <a href="download-ebook.html">
            
                    
                    Download Ebook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="CONTRIBUTING.html">
            
                <a href="CONTRIBUTING.html">
            
                    
                    Author &amp; Contributors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="DISTRIBUTION.html">
            
                <a href="DISTRIBUTION.html">
            
                    
                    Lisensi dan Distribusi Konten
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1">
            
                <span>
            
                    
                    Referensi Belajar Lainnya
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1">
            
                <a target="_blank" href="https://dasarpemrogramanpython.novalagung.com/">
            
                    
                    &#x1F4D6; Dasar Pemrograman Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2">
            
                <a target="_blank" href="https://dasarpemrogramanrust.novalagung.com/">
            
                    
                    &#x1F4D6; Dasar Pemrograman Rust
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3">
            
                <a target="_blank" href="https://howto.novalagung.com">
            
                    
                    &#x1F4D6; How To
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4">
            
                <a target="_blank" href="https://www.udemy.com/course/praktis-belajar-docker-dan-kubernetes-untuk-pemula/">
            
                    
                    &#x25B6;&#xFE0F; Udemy Course: Belajar Docker &amp; Kubernetes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="3.1">
            
                <span>
            
                    
                    A. Pemrograman Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="1-berkenalan-dengan-golang.html">
            
                <a href="1-berkenalan-dengan-golang.html">
            
                    
                    A.1. Belajar Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="2-instalasi-golang.html">
            
                <a href="2-instalasi-golang.html">
            
                    
                    A.2. Instalasi Golang (Stable &amp; Unstable)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="A-setup-go-project-dengan-go-modules.html">
            
                <a href="A-setup-go-project-dengan-go-modules.html">
            
                    
                    A.3. Setup Go Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="A-gopath-dan-workspace.html">
            
                <a href="A-gopath-dan-workspace.html">
            
                    
                    A.4. Setup GOPATH dan Workspace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="A-instalasi-editor.html">
            
                <a href="A-instalasi-editor.html">
            
                    
                    A.5. Instalasi Editor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="A-go-command.html">
            
                <a href="A-go-command.html">
            
                    
                    A.6. Go Command
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="A-hello-world.html">
            
                <a href="A-hello-world.html">
            
                    
                    A.7. Program Pertama: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="A-komentar.html">
            
                <a href="A-komentar.html">
            
                    
                    A.8. Komentar
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.9" data-path="A-variabel.html">
            
                <a href="A-variabel.html">
            
                    
                    A.9. Variabel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.10" data-path="A-tipe-data.html">
            
                <a href="A-tipe-data.html">
            
                    
                    A.10. Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.11" data-path="A-konstanta.html">
            
                <a href="A-konstanta.html">
            
                    
                    A.11. Konstanta
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.12" data-path="A-operator.html">
            
                <a href="A-operator.html">
            
                    
                    A.12. Operator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.13" data-path="A-seleksi-kondisi.html">
            
                <a href="A-seleksi-kondisi.html">
            
                    
                    A.13. Seleksi Kondisi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.14" data-path="A-perulangan.html">
            
                <a href="A-perulangan.html">
            
                    
                    A.14. Perulangan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.15" data-path="A-array.html">
            
                <a href="A-array.html">
            
                    
                    A.15. Array
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.16" data-path="A-slice.html">
            
                <a href="A-slice.html">
            
                    
                    A.16. Slice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.17" data-path="A-map.html">
            
                <a href="A-map.html">
            
                    
                    A.17. Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.18" data-path="A-fungsi.html">
            
                <a href="A-fungsi.html">
            
                    
                    A.18. Fungsi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.19" data-path="A-fungsi-multiple-return.html">
            
                <a href="A-fungsi-multiple-return.html">
            
                    
                    A.19. Fungsi Multiple Return
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.20" data-path="A-fungsi-variadic.html">
            
                <a href="A-fungsi-variadic.html">
            
                    
                    A.20. Fungsi Variadic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.21" data-path="A-fungsi-closure.html">
            
                <a href="A-fungsi-closure.html">
            
                    
                    A.21. Fungsi Closure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.22" data-path="A-fungsi-sebagai-parameter.html">
            
                <a href="A-fungsi-sebagai-parameter.html">
            
                    
                    A.22. Fungsi Sebagai parameter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.23" data-path="A-pointer.html">
            
                <a href="A-pointer.html">
            
                    
                    A.23. Pointer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.24" data-path="A-struct.html">
            
                <a href="A-struct.html">
            
                    
                    A.24. Struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.25" data-path="A-method.html">
            
                <a href="A-method.html">
            
                    
                    A.25. Method
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.26" data-path="A-properti-public-dan-private.html">
            
                <a href="A-properti-public-dan-private.html">
            
                    
                    A.26. Properti Public dan Private (Exported vs Unexported)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.27" data-path="A-interface.html">
            
                <a href="A-interface.html">
            
                    
                    A.27. Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.28" data-path="A-interface-kosong.html">
            
                <a href="A-interface-kosong.html">
            
                    
                    A.28. Any / interface{} / Interface Kosong
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.29" data-path="A-reflect.html">
            
                <a href="A-reflect.html">
            
                    
                    A.29. Reflect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.30" data-path="A-goroutine.html">
            
                <a href="A-goroutine.html">
            
                    
                    A.30. Goroutine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.31" data-path="A-channel.html">
            
                <a href="A-channel.html">
            
                    
                    A.31. Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.32" data-path="A-buffered-channel.html">
            
                <a href="A-buffered-channel.html">
            
                    
                    A.32. Buffered Channel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.33" data-path="A-channel-select.html">
            
                <a href="A-channel-select.html">
            
                    
                    A.33. Channel - Select
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.34" data-path="A-channel-range-close.html">
            
                <a href="A-channel-range-close.html">
            
                    
                    A.34. Channel - Range &amp; Close
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.35" data-path="A-channel-timeout.html">
            
                <a href="A-channel-timeout.html">
            
                    
                    A.35. Channel - Timeout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.36" data-path="A-defer-exit.html">
            
                <a href="A-defer-exit.html">
            
                    
                    A.36. Defer &amp; Exit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.37" data-path="A-error-panic-recover.html">
            
                <a href="A-error-panic-recover.html">
            
                    
                    A.37. Error, Panic, &amp; Recover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.38" data-path="A-string-format.html">
            
                <a href="A-string-format.html">
            
                    
                    A.38. Layout Format String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.39" data-path="A-random.html">
            
                <a href="A-random.html">
            
                    
                    A.39. Random
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.40" data-path="A-time-parsing-format.html">
            
                <a href="A-time-parsing-format.html">
            
                    
                    A.40. Time, Parsing Time, &amp; Format Time
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.41" data-path="A-timer-ticker-scheduler.html">
            
                <a href="A-timer-ticker-scheduler.html">
            
                    
                    A.41. Timer, Ticker, &amp; Scheduler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.42" data-path="A-time-duration.html">
            
                <a href="A-time-duration.html">
            
                    
                    A.42. Time Duration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.43" data-path="A-data-type-conversion.html">
            
                <a href="A-data-type-conversion.html">
            
                    
                    A.43. Konversi Antar Tipe Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.44" data-path="A-strings.html">
            
                <a href="A-strings.html">
            
                    
                    A.44. Fungsi String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.45" data-path="A-regex.html">
            
                <a href="A-regex.html">
            
                    
                    A.45. Regexp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.46" data-path="A-encoding-base64.html">
            
                <a href="A-encoding-base64.html">
            
                    
                    A.46. Encode - Decode Base64
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.47" data-path="A-hash-sha1.html">
            
                <a href="A-hash-sha1.html">
            
                    
                    A.47. Hash Sha1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.48" data-path="A-command-line-args-flag.html">
            
                <a href="A-command-line-args-flag.html">
            
                    
                    A.48. Arguments &amp; Flag
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.49" data-path="A-exec.html">
            
                <a href="A-exec.html">
            
                    
                    A.49. Exec
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.50" data-path="A-file.html">
            
                <a href="A-file.html">
            
                    
                    A.50. File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.51" data-path="A-web-server.html">
            
                <a href="A-web-server.html">
            
                    
                    A.51. Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.52" data-path="A-url-parsing.html">
            
                <a href="A-url-parsing.html">
            
                    
                    A.52. URL Parsing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.53" data-path="A-json.html">
            
                <a href="A-json.html">
            
                    
                    A.53. JSON Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.54" data-path="A-web-service-api.html">
            
                <a href="A-web-service-api.html">
            
                    
                    A.54. Web Service API Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.55" data-path="A-client-http-request-simple.html">
            
                <a href="A-client-http-request-simple.html">
            
                    
                    A.55. Simple Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.56" data-path="A-sql.html">
            
                <a href="A-sql.html">
            
                    
                    A.56. SQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.57" data-path="A-mongodb.html">
            
                <a href="A-mongodb.html">
            
                    
                    A.57. NoSQL MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.58" data-path="A-unit-test.html">
            
                <a href="A-unit-test.html">
            
                    
                    A.58. Unit Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.59" data-path="A-waitgroup.html">
            
                <a href="A-waitgroup.html">
            
                    
                    A.59. sync.WaitGroup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.60" data-path="A-mutex.html">
            
                <a href="A-mutex.html">
            
                    
                    A.60. sync.Mutex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.61" data-path="A-go-vendoring.html">
            
                <a href="A-go-vendoring.html">
            
                    
                    A.61. Go Vendoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.62" data-path="A-concurrency-pipeline.html">
            
                <a href="A-concurrency-pipeline.html">
            
                    
                    A.62. Concurrency Pattern: Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.63" data-path="A-simplified-fan-in-fan-out-pipeline.html">
            
                <a href="A-simplified-fan-in-fan-out-pipeline.html">
            
                    
                    A.63. Concurrency Pattern: Simplified Fan-in Fan-out Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.64" data-path="A-pipeline-context-cancellation.html">
            
                <a href="A-pipeline-context-cancellation.html">
            
                    
                    A.64. Concurrency Pattern: Context Cancellation Pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.65" data-path="A-golang-generics.html">
            
                <a href="A-golang-generics.html">
            
                    
                    A.65. Go Generics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="4.1">
            
                <span>
            
                    
                    B. Pemrograman Web Go Dasar
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="B-golang-web-hello-world.html">
            
                <a href="B-golang-web-hello-world.html">
            
                    
                    B.1. Golang Web App: Hello World
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="B-routing-http-handlefunc.html">
            
                <a href="B-routing-http-handlefunc.html">
            
                    
                    B.2. Routing http.HandleFunc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="B-routing-static-assets.html">
            
                <a href="B-routing-static-assets.html">
            
                    
                    B.3. Routing Static Assets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="B-template-render-html.html">
            
                <a href="B-template-render-html.html">
            
                    
                    B.4. Template: Render HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="B-template-render-partial-html.html">
            
                <a href="B-template-render-partial-html.html">
            
                    
                    B.5. Template: Render Partial HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="B-template-actions-variables.html">
            
                <a href="B-template-actions-variables.html">
            
                    
                    B.6. Template: Actions &amp; Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="B-template-functions.html">
            
                <a href="B-template-functions.html">
            
                    
                    B.7. Template: Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.8" data-path="B-template-custom-functions.html">
            
                <a href="B-template-custom-functions.html">
            
                    
                    B.8. Template: Custom Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.9" data-path="B-render-specific-html-template.html">
            
                <a href="B-render-specific-html-template.html">
            
                    
                    B.9. Template: Render Specific HTML Template
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.10" data-path="B-render-html-string.html">
            
                <a href="B-render-html-string.html">
            
                    
                    B.10. Template: Render HTML String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.11" data-path="B-http-method-basic.html">
            
                <a href="B-http-method-basic.html">
            
                    
                    B.11. HTTP Method: POST &amp; GET
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.12" data-path="B-form-value.html">
            
                <a href="B-form-value.html">
            
                    
                    B.12. Form Value
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.13" data-path="B-form-upload-file.html">
            
                <a href="B-form-upload-file.html">
            
                    
                    B.13. Form Upload File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.14" data-path="B-ajax-json-payload.html">
            
                <a href="B-ajax-json-payload.html">
            
                    
                    B.14. AJAX JSON Payload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.15" data-path="B-ajax-json-response.html">
            
                <a href="B-ajax-json-response.html">
            
                    
                    B.15. AJAX JSON Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.16" data-path="B-ajax-multi-upload.html">
            
                <a href="B-ajax-multi-upload.html">
            
                    
                    B.16. AJAX Multiple File Upload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.17" data-path="B-download-file.html">
            
                <a href="B-download-file.html">
            
                    
                    B.17. Download File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.18" data-path="B-http-basic-auth.html">
            
                <a href="B-http-basic-auth.html">
            
                    
                    B.18. HTTP Basic Auth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.19" data-path="B-middleware-using-http-handler.html">
            
                <a href="B-middleware-using-http-handler.html">
            
                    
                    B.19. Middleware http.Handler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.20" data-path="B-custom-mux-multiplexer.html">
            
                <a href="B-custom-mux-multiplexer.html">
            
                    
                    B.20. Custom Multiplexer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.21" data-path="B-cookie.html">
            
                <a href="B-cookie.html">
            
                    
                    B.21. HTTP Cookie
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.22" data-path="B-simple-configuration.html">
            
                <a href="B-simple-configuration.html">
            
                    
                    B.22. Simple Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.23" data-path="B-server-handler-http-request-cancellation.html">
            
                <a href="B-server-handler-http-request-cancellation.html">
            
                    
                    B.23. Server Handler HTTP Request Cancellation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1">
            
                <span>
            
                    
                    C. Pemrograman Go Lanjut
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="C-project-layout-structure.html">
            
                <a href="C-project-layout-structure.html">
            
                    
                    C.1. Project Layout Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="C-golang-web-framework.html">
            
                <a href="C-golang-web-framework.html">
            
                    
                    C.2. Go Web Framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="C-echo-routing.html">
            
                <a href="C-echo-routing.html">
            
                    
                    C.3. Echo Framework &amp; Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="C-parsing-http-request-payload-echo.html">
            
                <a href="C-parsing-http-request-payload-echo.html">
            
                    
                    C.4. Parsing HTTP Request Payload (Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.5" data-path="C-http-request-payload-validation.html">
            
                <a href="C-http-request-payload-validation.html">
            
                    
                    C.5. HTTP Request Payload Validation (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.6" data-path="C-http-error-handling.html">
            
                <a href="C-http-error-handling.html">
            
                    
                    C.6. HTTP Error Handling (Validator v9, Echo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.7" data-path="C-echo-template-rendering.html">
            
                <a href="C-echo-template-rendering.html">
            
                    
                    C.7. Template Rendering in Echo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.8" data-path="C-advanced-middleware-and-logging.html">
            
                <a href="C-advanced-middleware-and-logging.html">
            
                    
                    C.8. Advanced Middleware &amp; Logging (Logrus, Echo Logger)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.9" data-path="C-flag-parser.html">
            
                <a href="C-flag-parser.html">
            
                    
                    C.9. CLI Flag Parser (Kingpin)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.10" data-path="C-advanced-configuration-viper.html">
            
                <a href="C-advanced-configuration-viper.html">
            
                    
                    C.10. Advanced Configuration: Viper
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.11" data-path="C-best-practice-configuration-env-var.html">
            
                <a href="C-best-practice-configuration-env-var.html">
            
                    
                    C.11. Best Practice Configuration: Environment Variable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.12" data-path="C-securecookie.html">
            
                <a href="C-securecookie.html">
            
                    
                    C.12. Secure Cookie (Gorilla Securecookie)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.13" data-path="C-session.html">
            
                <a href="C-session.html">
            
                    
                    C.13. Session (Gorilla Session)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.14" data-path="C-cors-preflight-request.html">
            
                <a href="C-cors-preflight-request.html">
            
                    
                    C.14. CORS &amp; Preflight Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.15" data-path="C-csrf.html">
            
                <a href="C-csrf.html">
            
                    
                    C.15. CSRF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.16" data-path="C-secure-middleware.html">
            
                <a href="C-secure-middleware.html">
            
                    
                    C.16. Secure Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.17" data-path="C-http-gzip-compression.html">
            
                <a href="C-http-gzip-compression.html">
            
                    
                    C.17. HTTP Gzip Compression (gziphandler)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.18" data-path="C-send-email.html">
            
                <a href="C-send-email.html">
            
                    
                    C.18. Send Mail (net/smtp, Gomail v2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.19" data-path="C-read-write-excel-xlsx-file.html">
            
                <a href="C-read-write-excel-xlsx-file.html">
            
                    
                    C.19. Read &amp; Write Excel XLSX File (Excelize)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.20" data-path="C-write-pdf-file.html">
            
                <a href="C-write-pdf-file.html">
            
                    
                    C.20. Write PDF File (gofpdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.21" data-path="C-convert-html-to-pdf.html">
            
                <a href="C-convert-html-to-pdf.html">
            
                    
                    C.21. Convert HTML to PDF (go-wkhtmltopdf)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.22" data-path="C-scraping-parsing-html.html">
            
                <a href="C-scraping-parsing-html.html">
            
                    
                    C.22. Scraping &amp; Parsing HTML (goquery)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.23" data-path="C-xml-parser.html">
            
                <a href="C-xml-parser.html">
            
                    
                    C.23. Parse &amp; Generate XML (etree)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.24" data-path="C-https-tls.html">
            
                <a href="C-https-tls.html">
            
                    
                    C.24. HTTPS/TLS Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.25" data-path="C-http2-server-push.html">
            
                <a href="C-http2-server-push.html">
            
                    
                    C.25. HTTP/2 &amp; HTTP/2 Server Push
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.26" data-path="C-client-http-request-advanced.html">
            
                <a href="C-client-http-request-advanced.html">
            
                    
                    C.26. Advanced Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.27" data-path="C-secure-insecure-client-http-request.html">
            
                <a href="C-secure-insecure-client-http-request.html">
            
                    
                    C.27. Secure &amp; Insecure Client HTTP Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.28" data-path="C-golang-ftp.html">
            
                <a href="C-golang-ftp.html">
            
                    
                    C.28. FTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.29" data-path="C-golang-ssh-sftp.html">
            
                <a href="C-golang-ssh-sftp.html">
            
                    
                    C.29. SSH &amp; SFTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.30" data-path="C-golang-protobuf-implementation.html">
            
                <a href="C-golang-protobuf-implementation.html">
            
                    
                    C.30. Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.31" data-path="C-golang-grpc-protobuf.html">
            
                <a href="C-golang-grpc-protobuf.html">
            
                    
                    C.31. gRPC + Protobuf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.32" data-path="C-golang-jwt.html">
            
                <a href="C-golang-jwt.html">
            
                    
                    C.32. JSON Web Token (JWT)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.33" data-path="C-golang-ldap-authentication.html">
            
                <a href="C-golang-ldap-authentication.html">
            
                    
                    C.33. LDAP Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.34" data-path="C-golang-sso-saml-sp.html">
            
                <a href="C-golang-sso-saml-sp.html">
            
                    
                    C.34. SSO SAML (Service Provider)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.35" data-path="C-dockerize-golang.html">
            
                <a href="C-dockerize-golang.html">
            
                    
                    C.35. Dockerize Aplikasi Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.36" data-path="C-golang-redis.html">
            
                <a href="C-golang-redis.html">
            
                    
                    C.36. Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.37" data-path="C-singleflight.html">
            
                <a href="C-singleflight.html">
            
                    
                    C.37. Singleflight
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.38" data-path="C-golang-aws-s3.html">
            
                <a href="C-golang-aws-s3.html">
            
                    
                    C.38. AWS S3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="6.1">
            
                <span>
            
                    
                    D. Studi Kasus
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="6.1.1" data-path="D-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                <a href="D-insert-1mil-csv-record-into-db-in-a-minute.html">
            
                    
                    D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="D-google-api-search.html">
            
                <a href="D-google-api-search.html">
            
                    
                    D.2. Google API Search Dengan Timeout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="D-golang-web-socket-chatting-app.html">
            
                <a href="D-golang-web-socket-chatting-app.html">
            
                    
                    D.3. Web Socket: Chatting App
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".">D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h1 id="d1-insert-1-juta-data-dari-file-csv-ke-database-server-menggunakan-teknik-worker-pool-database-connection-pool-dan-mekanisme-failover">D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover.</h1>
<p>Pada chapter ini kita akan praktek penerapan salah satu teknik concurrent programming di Go yaitu worker pool, dikombinasikan dengan database connection pool, untuk membaca 1 juta rows data dari sebuah file csv untuk kemudian di-insert-kan ke mysql server.</p>
<p>Pada bagian insert data kita terapkan mekanisme failover, jadi ketika ada operasi insert gagal, maka akan otomatis di recover dan di retry. Jadi idealnya di akhir, semua data, sejumlah satu juta, akan berhasil di-insert.</p>
<h2 id="d11-penjelasan">D.1.1. Penjelasan</h2>
<h4 id="&#x25C9;-worker-pool">&#x25C9; Worker Pool</h4>
<p>Worker pool adalah teknik manajemen goroutine dalam <em>concurrent programming</em> pada Go. Sejumlah worker dijalankan dan masing-masing memiliki tugas yang sama yaitu menyelesaikan sejumlah jobs.</p>
<p>Dengan metode worker pool ini, maka penggunaan memory dan performansi program akan bisa optimal.</p>
<h4 id="&#x25C9;-database-connection-pool">&#x25C9; Database Connection Pool</h4>
<p><em>Connection pool</em> adalah metode untuk manajemen sejumlah koneksi database, agar bisa digunakan secara optimal.</p>
<p>Connection pool sangat penting dalam kasus operasi data yang berhubungan dengan database yang mana concurrent programming diterapkan.</p>
<p>Karena pada concurrent programming, beberapa proses akan berjalan bersamaan, maka penggunaan 1 koneksi db akan menghambat proses tersebut. Perlu ada beberapa koneksi database, agar goroutine tidak rebutan objek koneksi database.</p>
<h4 id="&#x25C9;-failover">&#x25C9; Failover</h4>
<p>Failover merupakan mekanisme backup ketika sebuah proses gagal. Pada konteks ini, failover mengarah ke proses untuk me-retry operasi insert ketika gagal.</p>
<h2 id="d12-persiapan">D.1.2. Persiapan</h2>
<p>File <a href="https://blog.majestic.com/development/majestic-million-csv-daily/" target="_blank">majestic-million-csv</a> digunakan sebagai bahan dalam praktek. File tersebut gratis dengan lisensi CCA3. Isinya adalah list dari top website berjumlah 1 juta.</p>
<p>Silakan download file nya di sini <a href="http://downloads.majestic.com/majestic_million.csv" target="_blank">http://downloads.majestic.com/majestic_million.csv</a>.</p>
<p>Setelah itu siapkan My SQL database server, create database dan sebuah tabel di dalamnya dengan nama domain.</p>
<pre><code class="lang-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">test</span>;
<span class="hljs-keyword">USE</span> <span class="hljs-keyword">test</span>;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">domain</span> (
    GlobalRank <span class="hljs-built_in">int</span>,
    TldRank <span class="hljs-built_in">int</span>,
    <span class="hljs-keyword">Domain</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),
    TLD <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),
    RefSubNets <span class="hljs-built_in">int</span>,
    RefIPs <span class="hljs-built_in">int</span>,
    IDN_Domain <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),
    IDN_TLD <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),
    PrevGlobalRank <span class="hljs-built_in">int</span>,
    PrevTldRank <span class="hljs-built_in">int</span>,
    PrevRefSubNets <span class="hljs-built_in">int</span>,
    PrevRefIPs <span class="hljs-built_in">int</span>
);
</code></pre>
<p>Setelah itu buat project baru, dan sebuah file <code>main.go</code>, dan tempatkan file csv yang sudah didownload dalam folder yang sama.</p>
<p>Karena di contoh ini saya menggunakan My SQL, maka perlu untuk go get driver RDBMS ini untuk go.</p>
<pre><code class="lang-bash">go get -u github.com/go-sql-driver/mysql
</code></pre>
<p>Jika pembaca ingin menggunakan driver lain, juga silakan.</p>
<h2 id="d13-praktek">D.1.3. Praktek</h2>
<h4 id="&#x25C9;-definisi-konstanta">&#x25C9; Definisi Konstanta</h4>
<p>Ada beberapa konstanta yang perlu dipersiapkan. Pertama connection string untuk komunikasi ke database server. Sesuaikan value nya dengan yang dipergunakan.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> dbConnString = <span class="hljs-string">&quot;root@/test&quot;</span>
</code></pre>
<p>Lalu jumlah koneksi idle yang diperbolehkan, kita set saja 4, karena nantinya semua connection yg di create akan sibuk untuk bekerja meng-insert data.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> dbMaxIdleConns = <span class="hljs-number">4</span>
</code></pre>
<p>Jumlah maksimum koneksi database dalam pool.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> dbMaxConns = <span class="hljs-number">100</span>
</code></pre>
<p>Jumlah worker yang akan bekerja untuk menjalankan job.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> totalWorker = <span class="hljs-number">100</span>
</code></pre>
<p>Path dari file CSV. Karena file berada satu level dengan <code>main.go</code> maka tulis saja nama file nya.</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> csvFile = <span class="hljs-string">&quot;majestic_million.csv&quot;</span>
</code></pre>
<p>Terakhir, siapkan variabel untuk menampung data header dari pembacaan CSV nanti.</p>
<pre><code class="lang-go"><span class="hljs-keyword">var</span> dataHeaders = <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">0</span>)
</code></pre>
<h4 id="&#x25C9;-fungsi-buka-koneksi-database">&#x25C9; Fungsi Buka Koneksi Database</h4>
<p>Buat fungsi untuk buka koneksi database, yg dikembalikan objek database kembalian fungsi <code>sql.Open()</code>.</p>
<p>Jangan lupa set nilai <code>MaxOpenConns</code> dan <code>MaxIdleConns</code>.</p>
<p>O iya, untuk yang tidak menggunakan mysql, maka sesuaikan saja nilai argument pertama statement <code>sql.Open()</code>.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> openDbConnection() (*sql.DB, error) {
    log.Println(<span class="hljs-string">&quot;=&gt; open db connection&quot;</span>)

    db, err := sql.Open(<span class="hljs-string">&quot;mysql&quot;</span>, dbConnString)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    db.SetMaxOpenConns(dbMaxConns)
    db.SetMaxIdleConns(dbMaxIdleConns)

    <span class="hljs-keyword">return</span> db, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>O iya jangan lupa untuk import driver nya.</p>
<pre><code class="lang-go"><span class="hljs-keyword">import</span> _ <span class="hljs-string">&quot;github.com/go-sql-driver/mysql&quot;</span>
</code></pre>
<h4 id="&#x25C9;-fungsi-baca-csv">&#x25C9; Fungsi Baca CSV</h4>
<p>Buka file CSV, lalu gunakan objek file untuk membuat objek CSV reader baru.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> openCsvFile() (*csv.Reader, *os.File, error) {
    log.Println(<span class="hljs-string">&quot;=&gt; open csv file&quot;</span>)

    f, err := os.Open(csvFile)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>, err
    }

    reader := csv.NewReader(f)
    <span class="hljs-keyword">return</span> reader, f, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 id="&#x25C9;-fungsi-menjalankan-workers">&#x25C9; Fungsi Menjalankan Workers</h4>
<p>Ok, sekarang kita mulai masuk ke aspek konkurensi dari pembahasan ini. Siapkan fungsi yang isinya men-dispatch beberapa goroutine sejumlah <code>totalWorker</code>.</p>
<p>Tiap-tiap goroutine tersebut adalah worker atau pekerja, yang tugasnya nanti akan meng-insert data ke database.</p>
<p>Saat aplikasi dijalankan, sejumlah 100 worker akan berlomba-lomba menyelesaikan job insert data sejumlah 1 juta data.</p>
<p>1 job adalah 1 data, maka rata-rata setiap worker akan menyelesaikan operasi insert sekitar 10k. Tapi ini jelasnya tidak pasti karena worker akan berkompetisi dalam penyelesaian job, jadi sangat besar kemungkinan akan ada job yang menyelesaikan lebih dari 10k jobs, ataupun yg di bawah 10k jobs.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> dispatchWorkers(db *sql.DB, jobs &lt;-<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">interface</span>{}, wg *sync.WaitGroup) {
    <span class="hljs-keyword">for</span> workerIndex := <span class="hljs-number">0</span>; workerIndex &lt;= totalWorker; workerIndex++ {
        <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>(workerIndex <span class="hljs-keyword">int</span>, db *sql.DB, jobs &lt;-<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">interface</span>{}, wg *sync.WaitGroup) {
            counter := <span class="hljs-number">0</span>

            <span class="hljs-keyword">for</span> job := <span class="hljs-keyword">range</span> jobs {
                doTheJob(workerIndex, counter, db, job)
                wg.Done()
                counter++
            }
        }(workerIndex, db, jobs, wg)
    }
}
</code></pre>
<p>Bisa dilihat dalam fungsi di atas, di dalam goroutine/worker, isi channel jobs (yang berupa data dari proses pembacaan CSV), didistribusikan ke worker, ke goroutine.</p>
<p>Fungsi <code>doTheJob()</code> yang nantinya kita buat, isinya adalah operasi insert data ke database server. Setiap satu operasi insert selesai, <code>wg.Done()</code> untuk menandai bahwa 1 job adalah selesai.</p>
<p>Idealnya di akhir aplikasi akan terjadi pemanggilan <code>wg.Done()</code> sejumlah 1 juta karena ada 1 juta jobs.</p>
<h4 id="&#x25C9;-fungsi-baca-csv-dan-pengiriman-jobs-ke-worker">&#x25C9; Fungsi Baca CSV dan Pengiriman Jobs ke Worker</h4>
<p>Proses pembacaan CSV, apapun metodenya pasti yang dijalankan adalah membaca data dari line ke line dari baris paling bawah.</p>
<blockquote>
<p>Proses baca satu file tidak bisa di-konkurensi-kan</p>
</blockquote>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> readCsvFilePerLineThenSendToWorker(csvReader *csv.Reader, jobs <span class="hljs-keyword">chan</span>&lt;- []<span class="hljs-keyword">interface</span>{}, wg *sync.WaitGroup) {
    <span class="hljs-keyword">for</span> {
        row, err := csvReader.Read()
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">if</span> err == io.EOF {
                err = <span class="hljs-literal">nil</span>
            }
            <span class="hljs-keyword">break</span>
        }

        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(dataHeaders) == <span class="hljs-number">0</span> {
            dataHeaders = row
            <span class="hljs-keyword">continue</span>
        }

        rowOrdered := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">interface</span>{}, <span class="hljs-number">0</span>)
        <span class="hljs-keyword">for</span> _, each := <span class="hljs-keyword">range</span> row {
            rowOrdered = <span class="hljs-built_in">append</span>(rowOrdered, each)
        }

        wg.Add(<span class="hljs-number">1</span>)
        jobs &lt;- rowOrdered
    }
    <span class="hljs-built_in">close</span>(jobs)
}
</code></pre>
<p>Data dibaca dalam perulangan per baris. Pada pembacaan pertama, rows akan ditampung ke variabel <code>dataHeaders</code>. Selanjutnya, data dikirimkan ke worker lewat channel <code>jobs</code>.</p>
<p>Setelah proses baca data selesai, channel di close. Karena pengiriman dan penerimaan data pada channel bersifat synchronous untuk unbuffered channel. Jadi aman untuk berasumsi bahwa ketika semua data berhasil dikirim, maka semua data tersebut juga berhasil diterima.</p>
<p>Jika blok kode perulangan dalam fungsi di atas selesai, maka sudah tidak ada lagi operasi kirim terima data, maka kita close channelnya.</p>
<h4 id="&#x25C9;-fungsi-insert-data-ke-database">&#x25C9; Fungsi Insert Data ke Database</h4>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> doTheJob(workerIndex, counter <span class="hljs-keyword">int</span>, db *sql.DB, values []<span class="hljs-keyword">interface</span>{}) {
    <span class="hljs-keyword">for</span> {
        <span class="hljs-keyword">var</span> outerError error
        <span class="hljs-keyword">func</span>(outerError *error) {
            <span class="hljs-keyword">defer</span> <span class="hljs-keyword">func</span>() {
                <span class="hljs-keyword">if</span> err := <span class="hljs-built_in">recover</span>(); err != <span class="hljs-literal">nil</span> {
                    *outerError = fmt.Errorf(<span class="hljs-string">&quot;%v&quot;</span>, err)
                }
            }()

            conn, err := db.Conn(context.Background())
            query := fmt.Sprintf(<span class="hljs-string">&quot;INSERT INTO domain (%s) VALUES (%s)&quot;</span>,
                strings.Join(dataHeaders, <span class="hljs-string">&quot;,&quot;</span>),
                strings.Join(generateQuestionsMark(<span class="hljs-built_in">len</span>(dataHeaders)), <span class="hljs-string">&quot;,&quot;</span>),
            )

            _, err = conn.ExecContext(context.Background(), query, values...)
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                log.Fatal(err.Error())
            }

            err = conn.Close()
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                log.Fatal(err.Error())
            }
        }(&amp;outerError)
        <span class="hljs-keyword">if</span> outerError == <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">break</span>
        }
    }

    <span class="hljs-keyword">if</span> counter%<span class="hljs-number">100</span> == <span class="hljs-number">0</span> {
        log.Println(<span class="hljs-string">&quot;=&gt; worker&quot;</span>, workerIndex, <span class="hljs-string">&quot;inserted&quot;</span>, counter, <span class="hljs-string">&quot;data&quot;</span>)
    }
}

<span class="hljs-keyword">func</span> generateQuestionsMark(n <span class="hljs-keyword">int</span>) []<span class="hljs-keyword">string</span> {
    s := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">string</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; n; i++ {
        s = <span class="hljs-built_in">append</span>(s, <span class="hljs-string">&quot;?&quot;</span>)
    }
    <span class="hljs-keyword">return</span> s
}
</code></pre>
<p>Pada kode di atas bisa dilihat bahwa kode insert dibungkus dalam IIFE dalam sebuah perulangan.</p>
<p>Kenapa butuh perulangan? keyword <code>for</code> di atas perannya sangat penting. Di sini diterapkan mekanisme failover di mana ketika proses insert gagal akan di recover dan di-retry ulang.</p>
<p>Nah jadi ketika operasi insert di atas gagal, maka error tetap di tampilkan tapi kemudian diulang kembali insert data yang gagal tadi, hingga sukses.</p>
<p>O iya, mengenai kode untuk manajemen db connection poll mana ya? sepertinya tidak ada. Yups, memang tidak ada. As per Go official documentation untuk package <code>sql/database</code>, connection pool di manage oleh Go, kita engineer cukup panggil method <code>.Conn()</code> milik <code>*sql.DB</code> untuk mengambil pool item, yang pool item ini bisa berupa connection lama yang di reuse atau connection yang baru dibuat.</p>
<blockquote>
<p>Conn returns a single connection by either opening a new connection or returning an existing connection from the connection pool. Conn will block until either a connection is returned or ctx is canceled. Queries run on the same Conn will be run in the same database session.<br>Every Conn must be returned to the database pool after use by calling Conn.Close.</p>
</blockquote>
<p>Btw, di atas juga ada satu fungsi lagi, <code>generateQuestionsMark()</code>, gunanya untuk membantu pembentukan query insert data secara dinamis.</p>
<h4 id="&#x25C9;-fungsi-main">&#x25C9; Fungsi Main</h4>
<p>Terakhir, panggil semua fungsi yang sudah dibuat pada main.</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> main() {
    start := time.Now()

    db, err := openDbConnection()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatal(err.Error())
    }

    csvReader, csvFile, err := openCsvFile()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatal(err.Error())
    }
    <span class="hljs-keyword">defer</span> csvFile.Close()

    jobs := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> []<span class="hljs-keyword">interface</span>{}, <span class="hljs-number">0</span>)
    wg := <span class="hljs-built_in">new</span>(sync.WaitGroup)

    <span class="hljs-keyword">go</span> dispatchWorkers(db, jobs, wg)
    readCsvFilePerLineThenSendToWorker(csvReader, jobs, wg)

    wg.Wait()

    duration := time.Since(start)
    fmt.Println(<span class="hljs-string">&quot;done in&quot;</span>, <span class="hljs-keyword">int</span>(math.Ceil(duration.Seconds())), <span class="hljs-string">&quot;seconds&quot;</span>)
}
</code></pre>
<p>Di akhir fungsi main ditambahkan log untuk benchmark performa.</p>
<h2 id="d14-eksekusi-program">D.1.4. Eksekusi Program</h2>
<p>Ok, sekarang mari kita coba eksekusi program-nya.</p>
<p><img src="images/D_insert_1mil_csv_record_into_db_in_a_minute_1_preview.png" alt="Dasar Pemrograman Golang - Preview"></p>
<p>Nah, bisa dilihat operasi insert selesai dalam waktu sekitar 1 menitan. Saya menggunakan laptop dengan spek berikut untuk run program:</p>
<ul>
<li>Core i7-8750H 2.20GHz (6 core, 12 logical prosesor)</li>
<li>RAM 16GB</li>
<li>SSD</li>
</ul>
<p>Kalau diperhatikan, hanya 25.8% utilisasi CPU, dan hanya 12MB saja resource RAM yang dibutuhkan. Di Task Manager CPU usage nya 100% karena My SQL server di lokal saya benar-benar bekerja keras untuk menjalankan operasi insert.</p>
<blockquote>
<p>Kecepatan aplikasi sangat tergantung dengan spesifikasi hardware laptop/server yang dipakai.</p>
</blockquote>
<p>Kalau dibandingkan dengan operasi insert data secara sekuensial, yang tanpa worker pool dan tanpa db connection pool, memakan waktu hingga <strong>20 MENIT!</strong>. Metode pada chapter ini jauh lebih cepat.</p>
<p>Praktek pada chapter ini sifatnya adalah POC, jadi sangat mungkin diperlukan penyesuaian untuk kasus nyata. Kode di atas sebenarnya juga masih bisa di optimize lagi dari banyak sisi.</p>
<hr>
<ul>
<li><a href="https://github.com/go-sql-driver/mysql" target="_blank">go-sql-driver/mysql</a>, by Go SQL Driver Team, Mozilla Public License 2.0</li>
</ul>
<hr>
<div class="source-code-link">
    <div class="source-code-link-message">Source code praktik chapter ini tersedia di Github</div>
    <a href="https://github.com/novalagung/dasarpemrogramangolang-example/tree/master/chapter-D.1-insert-1mil-csv-record-into-db-in-a-minute" target="_blank">https://github.com/novalagung/dasarpemrogramangolang-example/...</a>
</div>

<hr>
<iframe src="partial/ebooks.html" width="100%" height="390px" frameborder="0" scrolling="no"></iframe>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="D-google-api-search.html" class="navigation navigation-next navigation-unique" aria-label="Next page: D.2. Google API Search Dengan Timeout">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover","level":"6.1.1","depth":2,"next":{"title":"D.2. Google API Search Dengan Timeout","level":"6.1.2","depth":2,"path":"D-google-api-search.md","ref":"D-google-api-search.md","articles":[]},"previous":{"title":"D. Studi Kasus","level":"6.1","depth":1,"ref":"","articles":[{"title":"D.1. Insert 1 Juta Data dari File CSV Ke Database Server, Menggunakan Teknik Worker Pool, Database Connection Pool, dan Mekanisme Failover","level":"6.1.1","depth":2,"path":"D-insert-1mil-csv-record-into-db-in-a-minute.md","ref":"D-insert-1mil-csv-record-into-db-in-a-minute.md","articles":[]},{"title":"D.2. Google API Search Dengan Timeout","level":"6.1.2","depth":2,"path":"D-google-api-search.md","ref":"D-google-api-search.md","articles":[]},{"title":"D.3. Web Socket: Chatting App","level":"6.1.3","depth":2,"path":"D-golang-web-socket-chatting-app.md","ref":"D-golang-web-socket-chatting-app.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["-search","-lunr","docsearch-v3","disqus","meta","sitemap"],"pluginsConfig":{"docsearch":{"appId":"ZV0MXP90GF","apiKey":"f7431c709385fe300da4c2ef2093c43c","indexName":"dasarpemrogramangolang-novalagung"},"disqus":{"useIdentifier":false,"shortName":"dasarpemrogramangolang"},"meta":{"name":"","content":"","data":[{"name":"google-site-verification","content":"UZnxS2Dk3fm2_Elms3a__56Q_oQ3sQ1h0SVXXlHSmbE"},{"name":"og:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"},{"name":"twitter:image","content":"https://dasarpemrogramangolang.novalagung.com/images/cover_fb_share.jpg"}]},"docsearch-v3":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sitemap":{"hostname":"https://dasarpemrogramangolang.novalagung.com/"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"D-insert-1mil-csv-record-into-db-in-a-minute.md","mtime":"2024-08-30T07:19:25.777Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-08-30T07:20:16.895Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-docsearch-v3/init.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    <div style="position: fixed; top: 10px; right: 30px; padding: 10px; background-color: rgba(255, 255, 255, 0.7);">
			<a class="github-button" href="https://github.com/sponsors/novalagung" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-heart" data-size="large" aria-label="Sponsor @novalagung on GitHub">Sponsor</a>&nbsp;
			<a class="github-button" href="https://github.com/novalagung/dasarpemrogramangolang" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star novalagung/dasarpemrogramangolang on GitHub">Star</a>&nbsp;
			<a class="github-button" href="https://github.com/novalagung" data-size="large" aria-label="Follow @novalagung on GitHub">Follow @novalagung</a>
			<script async defer src="https://buttons.github.io/buttons.js"></script>
		</div></body>
</html>